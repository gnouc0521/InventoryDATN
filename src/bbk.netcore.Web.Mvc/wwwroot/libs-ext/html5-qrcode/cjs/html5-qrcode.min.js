/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/html5-qrcode@2.3.4/cjs/html5-qrcode.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var __extends=this&&this.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Html5Qrcode=void 0;var core_1=require("./core"),strings_1=require("./strings"),utils_1=require("./utils"),code_decoder_1=require("./code-decoder"),factories_1=require("./camera/factories"),retriever_1=require("./camera/retriever"),state_manager_1=require("./state-manager"),Constants=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.DEFAULT_WIDTH=300,t.DEFAULT_WIDTH_OFFSET=2,t.FILE_SCAN_MIN_HEIGHT=300,t.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,t.MIN_QR_BOX_SIZE=50,t.SHADED_LEFT=1,t.SHADED_RIGHT=2,t.SHADED_TOP=3,t.SHADED_BOTTOM=4,t.SHADED_REGION_ELEMENT_ID="qr-shaded-region",t.VERBOSE=!1,t.BORDER_SHADER_DEFAULT_COLOR="#ffffff",t.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",t}(core_1.Html5QrcodeConstants),InternalHtml5QrcodeConfig=function(){function e(e,t){this.logger=t,this.fps=Constants.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=!0===e.disableFlip,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=Constants.DEFAULT_DISABLE_FLIP}return e.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?utils_1.VideoConstraintsUtil.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},e.prototype.isShadedBoxEnabled=function(){return!core_1.isNullOrUndefined(this.qrbox)},e.create=function(t,r){return new e(t,r)},e}(),Html5Qrcode=function(){function e(e,t){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw"HTML Element with id="+e+" not found";var r;this.elementId=e,this.verbose=!1,"boolean"==typeof t?this.verbose=!0===t:t&&(r=t,this.verbose=!0===r.verbose,r.experimentalFeatures),this.logger=new core_1.BaseLoggger(this.verbose),this.qrcode=new code_decoder_1.Html5QrcodeShim(this.getSupportedFormats(t),this.getUseBarCodeDetectorIfSupported(r),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=state_manager_1.StateManagerFactory.create()}return e.prototype.start=function(e,t,r,n){var o,i=this;if(!e)throw"cameraIdOrConfig is required";if(!r||"function"!=typeof r)throw"qrCodeSuccessCallback is required and should be a function.";o=n||(this.verbose?this.logger.log:function(){});var a=InternalHtml5QrcodeConfig.create(t,this.logger);this.clearElement();var s=!1;a.videoConstraints&&(a.isMediaStreamConstraintsValid()?s=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var d=s,c=document.getElementById(this.elementId);c.clientWidth?c.clientWidth:Constants.DEFAULT_WIDTH;c.style.position="relative",this.shouldScan=!0,this.element=c;var l=this,h=this.stateManagerProxy.startTransition(state_manager_1.Html5QrcodeScannerState.SCANNING);return new Promise((function(t,n){var s=d?a.videoConstraints:l.createVideoConstraints(e);if(!s)return h.cancel(),void n("videoConstraints should be defined");var c={};d&&!a.aspectRatio||(c.aspectRatio=a.aspectRatio);var u={onRenderSurfaceReady:function(e,t){l.setupUi(e,t,a),l.isScanning=!0,l.foreverScan(a,r,o)}};factories_1.CameraFactory.failIfNotSupported().then((function(e){e.create(s).then((function(e){return e.render(i.element,c,u).then((function(e){l.renderedCamera=e,h.execute(),t(null)})).catch((function(e){h.cancel(),n(e)}))})).catch((function(e){h.cancel(),n(strings_1.Html5QrcodeStrings.errorGettingUserMedia(e))}))})).catch((function(e){h.cancel(),n(strings_1.Html5QrcodeStrings.cameraStreamingNotSupported())}))}))},e.prototype.pause=function(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(state_manager_1.Html5QrcodeScannerState.PAUSED),this.showPausedState(),(core_1.isNullOrUndefined(e)||!0!==e)&&(e=!1),e&&this.renderedCamera&&this.renderedCamera.pause()},e.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var e=this,t=function(){e.stateManagerProxy.directTransition(state_manager_1.Html5QrcodeScannerState.SCANNING),e.hidePausedState()};this.renderedCamera.isPaused()?this.renderedCamera.resume((function(){t()})):t()},e.prototype.getState=function(){return this.stateManagerProxy.getState()},e.prototype.stop=function(){var e=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var t=this.stateManagerProxy.startTransition(state_manager_1.Html5QrcodeScannerState.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var r=this;return this.renderedCamera.close().then((function(){return r.renderedCamera=null,r.element&&(r.element.removeChild(r.canvasElement),r.canvasElement=null),function(){if(e.element){var t=document.getElementById(Constants.SHADED_REGION_ELEMENT_ID);t&&e.element.removeChild(t)}}(),r.qrRegion&&(r.qrRegion=null),r.context&&(r.context=null),t.execute(),r.hidePausedState(),r.isScanning=!1,Promise.resolve()}))},e.prototype.scanFile=function(e,t){return this.scanFileV2(e,t).then((function(e){return e.decodedText}))},e.prototype.scanFileV2=function(e,t){var r=this;if(!(e&&e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(core_1.isNullOrUndefined(t)&&(t=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise((function(n,o){r.possiblyCloseLastScanImageFile(),r.clearElement(),r.lastScanImageFile=URL.createObjectURL(e);var i=new Image;i.onload=function(){var e=i.width,a=i.height,s=document.getElementById(r.elementId),d=s.clientWidth?s.clientWidth:Constants.DEFAULT_WIDTH,c=Math.max(s.clientHeight?s.clientHeight:a,Constants.FILE_SCAN_MIN_HEIGHT),l=r.computeCanvasDrawConfig(e,a,d,c);if(t){var h=r.createCanvasElement(d,c,"qr-canvas-visible");h.style.display="inline-block",s.appendChild(h);var u=h.getContext("2d");if(!u)throw"Unable to get 2d context from canvas";u.canvas.width=d,u.canvas.height=c,u.drawImage(i,0,0,e,a,l.x,l.y,l.width,l.height)}var p=Constants.FILE_SCAN_HIDDEN_CANVAS_PADDING,f=Math.max(i.width,l.width),g=Math.max(i.height,l.height),m=f+2*p,y=g+2*p,S=r.createCanvasElement(m,y);s.appendChild(S);var v=S.getContext("2d");if(!v)throw"Unable to get 2d context from canvas";v.canvas.width=m,v.canvas.height=y,v.drawImage(i,0,0,e,a,p,p,f,g);try{r.qrcode.decodeRobustlyAsync(S).then((function(e){n(core_1.Html5QrcodeResultFactory.createFromQrcodeResult(e))})).catch(o)}catch(e){o("QR code parse error, error = "+e)}},i.onerror=o,i.onabort=o,i.onstalled=o,i.onsuspend=o,i.src=URL.createObjectURL(e)}))},e.prototype.clear=function(){this.clearElement()},e.getCameras=function(){return retriever_1.CameraRetriever.retrieve()},e.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},e.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},e.prototype.applyVideoConstraints=function(e){if(!e)throw"videoConstaints is required argument.";if(!utils_1.VideoConstraintsUtil.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details";return this.getRenderedCameraOrFail().applyVideoConstraints(e)},e.prototype.getRenderedCameraOrFail=function(){if(null==this.renderedCamera)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},e.prototype.getSupportedFormats=function(e){var t=[core_1.Html5QrcodeSupportedFormats.QR_CODE,core_1.Html5QrcodeSupportedFormats.AZTEC,core_1.Html5QrcodeSupportedFormats.CODABAR,core_1.Html5QrcodeSupportedFormats.CODE_39,core_1.Html5QrcodeSupportedFormats.CODE_93,core_1.Html5QrcodeSupportedFormats.CODE_128,core_1.Html5QrcodeSupportedFormats.DATA_MATRIX,core_1.Html5QrcodeSupportedFormats.MAXICODE,core_1.Html5QrcodeSupportedFormats.ITF,core_1.Html5QrcodeSupportedFormats.EAN_13,core_1.Html5QrcodeSupportedFormats.EAN_8,core_1.Html5QrcodeSupportedFormats.PDF_417,core_1.Html5QrcodeSupportedFormats.RSS_14,core_1.Html5QrcodeSupportedFormats.RSS_EXPANDED,core_1.Html5QrcodeSupportedFormats.UPC_A,core_1.Html5QrcodeSupportedFormats.UPC_E,core_1.Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION];if(!e||"boolean"==typeof e)return t;if(!e.formatsToSupport)return t;if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(0===e.formatsToSupport.length)throw"Atleast 1 formatsToSupport is needed.";for(var r=[],n=0,o=e.formatsToSupport;n<o.length;n++){var i=o[n];core_1.isValidHtml5QrcodeSupportedFormats(i)?r.push(i):this.logger.warn("Invalid format: "+i+" passed in config, ignoring.")}if(0===r.length)throw"None of formatsToSupport match supported values.";return r},e.prototype.getUseBarCodeDetectorIfSupported=function(e){if(core_1.isNullOrUndefined(e))return!0;if(!core_1.isNullOrUndefined(e.useBarCodeDetectorIfSupported))return!1!==e.useBarCodeDetectorIfSupported;if(core_1.isNullOrUndefined(e.experimentalFeatures))return!0;var t=e.experimentalFeatures;return!!core_1.isNullOrUndefined(t.useBarCodeDetectorIfSupported)||!1!==t.useBarCodeDetectorIfSupported},e.prototype.validateQrboxSize=function(e,t,r){var n=this,o=r.qrbox;this.validateQrboxConfig(o);var i,a=this.toQrdimensions(e,t,o),s=function(e){if(e<Constants.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is "+Constants.MIN_QR_BOX_SIZE+"px."};s(a.width),s(a.height),a.width=((i=a.width)>e&&(n.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),i=e),i)},e.prototype.validateQrboxConfig=function(e){if("number"!=typeof e&&"function"!=typeof e&&(void 0===e.width||void 0===e.height))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},e.prototype.toQrdimensions=function(e,t,r){if("number"==typeof r)return{width:r,height:r};if("function"==typeof r)try{return r(e,t)}catch(e){throw new Error("qrbox config was passed as a function but it failed with unknown error"+e)}return r},e.prototype.setupUi=function(e,t,r){r.isShadedBoxEnabled()&&this.validateQrboxSize(e,t,r);var n=core_1.isNullOrUndefined(r.qrbox)?{width:e,height:t}:r.qrbox;this.validateQrboxConfig(n);var o=this.toQrdimensions(e,t,n);o.height>t&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var i=r.isShadedBoxEnabled()&&o.height<=t,a={x:0,y:0,width:e,height:t},s=i?this.getShadedRegionBounds(e,t,o):a,d=this.createCanvasElement(s.width,s.height),c=d.getContext("2d",{willReadFrequently:!0});c.canvas.width=s.width,c.canvas.height=s.height,this.element.append(d),i&&this.possiblyInsertShadingElement(this.element,e,t,o),this.createScannerPausedUiElement(this.element),this.qrRegion=s,this.context=c,this.canvasElement=d},e.prototype.createScannerPausedUiElement=function(e){var t=document.createElement("div");t.innerText="Scanner paused",t.style.display="none",t.style.position="absolute",t.style.top="0px",t.style.zIndex="1",t.style.background="yellow",t.style.textAlign="center",t.style.width="100%",e.appendChild(t),this.scannerPausedUiElement=t},e.prototype.scanContext=function(e,t){var r=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then((function(t){return e(t.text,core_1.Html5QrcodeResultFactory.createFromQrcodeResult(t)),r.possiblyUpdateShaders(!0),!0})).catch((function(e){r.possiblyUpdateShaders(!1);var n=strings_1.Html5QrcodeStrings.codeParseError(e);return t(n,core_1.Html5QrcodeErrorFactory.createFrom(n)),!1}))},e.prototype.foreverScan=function(e,t,r){var n=this;if(this.shouldScan&&this.renderedCamera){var o=this.renderedCamera.getSurface(),i=o.videoWidth/o.clientWidth,a=o.videoHeight/o.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var s=this.qrRegion.width*i,d=this.qrRegion.height*a,c=this.qrRegion.x*i,l=this.qrRegion.y*a;this.context.drawImage(o,c,l,s,d,0,0,this.qrRegion.width,this.qrRegion.height);var h=function(){n.foreverScanTimeout=setTimeout((function(){n.foreverScan(e,t,r)}),n.getTimeoutFps(e.fps))};this.scanContext(t,r).then((function(o){o||!0===e.disableFlip?h():(n.context.translate(n.context.canvas.width,0),n.context.scale(-1,1),n.scanContext(t,r).finally((function(){h()})))})).catch((function(e){n.logger.logError("Error happend while scanning context",e),h()}))}},e.prototype.createVideoConstraints=function(e){if("string"==typeof e)return{deviceId:{exact:e}};if("object"==typeof e){var t="facingMode",r="deviceId",n={user:!0,environment:!0},o="exact",i=function(e){if(e in n)return!0;throw"config has invalid 'facingMode' value = '"+e+"'"},a=Object.keys(e);if(1!==a.length)throw"'cameraIdOrConfig' object should have exactly 1 key, if passed as an object, found "+a.length+" keys";var s=Object.keys(e)[0];if(s!==t&&s!==r)throw"Only 'facingMode' and 'deviceId'  are supported for 'cameraIdOrConfig'";if(s!==t){var d=e.deviceId;if("string"==typeof d)return{deviceId:d};if("object"==typeof d){if(o in d)return{deviceId:{exact:d.exact}};throw"'deviceId' should be string or object with exact as key."}throw"Invalid type of 'deviceId' = "+typeof d}var c=e.facingMode;if("string"==typeof c){if(i(c))return{facingMode:c}}else{if("object"!=typeof c)throw"Invalid type of 'facingMode' = "+typeof c;if(!(o in c))throw"'facingMode' should be string or object with exact as key.";if(i(c.exact))return{facingMode:{exact:c.exact}}}}throw"Invalid type of 'cameraIdOrConfig' = "+typeof e},e.prototype.computeCanvasDrawConfig=function(e,t,r,n){if(e<=r&&t<=n)return{x:(r-e)/2,y:(n-t)/2,width:e,height:t};var o=e,i=t;return e>r&&(t*=r/e,e=r),t>n&&(e*=n/t,t=n),this.logger.log("Image downsampled from "+o+"X"+i+" to "+e+"X"+t+"."),this.computeCanvasDrawConfig(e,t,r,n)},e.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var e=document.getElementById(this.elementId);e&&(e.innerHTML="")},e.prototype.possiblyUpdateShaders=function(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach((function(t){t.style.backgroundColor=e?Constants.BORDER_SHADER_MATCH_COLOR:Constants.BORDER_SHADER_DEFAULT_COLOR})),this.qrMatch=e)},e.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},e.prototype.createCanvasElement=function(e,t,r){var n=e,o=t,i=document.createElement("canvas");return i.style.width=n+"px",i.style.height=o+"px",i.style.display="none",i.id=core_1.isNullOrUndefined(r)?"qr-canvas":r,i},e.prototype.getShadedRegionBounds=function(e,t,r){if(r.width>e||r.height>t)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-r.width)/2,y:(t-r.height)/2,width:r.width,height:r.height}},e.prototype.possiblyInsertShadingElement=function(e,t,r,n){if(!(t-n.width<1||r-n.height<1)){var o=document.createElement("div");o.style.position="absolute";var i=(t-n.width)/2,a=(r-n.height)/2;if(o.style.borderLeft=i+"px solid rgba(0, 0, 0, 0.48)",o.style.borderRight=i+"px solid rgba(0, 0, 0, 0.48)",o.style.borderTop=a+"px solid rgba(0, 0, 0, 0.48)",o.style.borderBottom=a+"px solid rgba(0, 0, 0, 0.48)",o.style.boxSizing="border-box",o.style.top="0px",o.style.bottom="0px",o.style.left="0px",o.style.right="0px",o.id=""+Constants.SHADED_REGION_ELEMENT_ID,t-n.width<11||r-n.height<11)this.hasBorderShaders=!1;else{var s=40;this.insertShaderBorders(o,s,5,-5,null,0,!0),this.insertShaderBorders(o,s,5,-5,null,0,!1),this.insertShaderBorders(o,s,5,null,-5,0,!0),this.insertShaderBorders(o,s,5,null,-5,0,!1),this.insertShaderBorders(o,5,45,-5,null,-5,!0),this.insertShaderBorders(o,5,45,null,-5,-5,!0),this.insertShaderBorders(o,5,45,-5,null,-5,!1),this.insertShaderBorders(o,5,45,null,-5,-5,!1),this.hasBorderShaders=!0}e.append(o)}},e.prototype.insertShaderBorders=function(e,t,r,n,o,i,a){var s=document.createElement("div");s.style.position="absolute",s.style.backgroundColor=Constants.BORDER_SHADER_DEFAULT_COLOR,s.style.width=t+"px",s.style.height=r+"px",null!==n&&(s.style.top=n+"px"),null!==o&&(s.style.bottom=o+"px"),a?s.style.left=i+"px":s.style.right=i+"px",this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(s),e.appendChild(s)},e.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},e.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},e.prototype.getTimeoutFps=function(e){return 1e3/e},e}();exports.Html5Qrcode=Html5Qrcode;
//# sourceMappingURL=/sm/0a393dc870f9c81ba57aaf1c817284bdbd315aa91744ae825f6d22de4fa8f95c.map