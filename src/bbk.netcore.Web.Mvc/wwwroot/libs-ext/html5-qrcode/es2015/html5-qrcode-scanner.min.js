/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/html5-qrcode@2.3.4/es2015/html5-qrcode-scanner.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Html5QrcodeConstants,Html5QrcodeScanType,Html5QrcodeErrorFactory,BaseLoggger,isNullOrUndefined,clip}from"./core";import{Html5Qrcode}from"./html5-qrcode";import{Html5QrcodeScannerStrings}from"./strings";import{ASSET_FILE_SCAN,ASSET_CAMERA_SCAN}from"./image-assets";import{PersistedDataManager}from"./storage";import{LibraryInfoContainer}from"./ui";import{CameraPermissions}from"./camera/permissions";import{ScanTypeSelector}from"./ui/scanner/scan-type-selector";import{TorchButton}from"./ui/scanner/torch-button";import{FileSelectionUi}from"./ui/scanner/file-selection-ui";import{BaseUiElementFactory,PublicUiElementIdAndClasses}from"./ui/scanner/base";import{CameraSelectionUi}from"./ui/scanner/camera-selection-ui";import{CameraZoomUi}from"./ui/scanner/camera-zoom-ui";var Html5QrcodeScannerStatus;function toHtml5QrcodeCameraScanConfig(e){return{fps:e.fps,qrbox:e.qrbox,aspectRatio:e.aspectRatio,disableFlip:e.disableFlip,videoConstraints:e.videoConstraints}}function toHtml5QrcodeFullConfig(e,t){return{formatsToSupport:e.formatsToSupport,useBarCodeDetectorIfSupported:e.useBarCodeDetectorIfSupported,experimentalFeatures:e.experimentalFeatures,verbose:t}}!function(e){e[e.STATUS_DEFAULT=0]="STATUS_DEFAULT",e[e.STATUS_SUCCESS=1]="STATUS_SUCCESS",e[e.STATUS_WARNING=2]="STATUS_WARNING",e[e.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"}(Html5QrcodeScannerStatus||(Html5QrcodeScannerStatus={}));export class Html5QrcodeScanner{constructor(e,t,a){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.fileSelectionUi=null,this.elementId=e,this.config=this.createConfig(t),this.verbose=!0===a,!document.getElementById(e))throw`HTML Element with id=${e} not found`;this.scanTypeSelector=new ScanTypeSelector(this.config.supportedScanTypes),this.currentScanType=this.scanTypeSelector.getDefaultScanType(),this.sectionSwapAllowed=!0,this.logger=new BaseLoggger(this.verbose),this.persistedDataManager=new PersistedDataManager,!0!==t.rememberLastUsedCamera&&this.persistedDataManager.reset()}render(e,t){this.lastMatchFound=null,this.qrCodeSuccessCallback=(t,a)=>{if(e)e(t,a);else{if(this.lastMatchFound===t)return;this.lastMatchFound=t,this.setHeaderMessage(Html5QrcodeScannerStrings.lastMatch(t),Html5QrcodeScannerStatus.STATUS_SUCCESS)}},this.qrCodeErrorCallback=(e,a)=>{t&&t(e,a)};const a=document.getElementById(this.elementId);if(!a)throw`HTML Element with id=${this.elementId} not found`;a.innerHTML="",this.createBasicLayout(a),this.html5Qrcode=new Html5Qrcode(this.getScanRegionId(),toHtml5QrcodeFullConfig(this.config,this.verbose))}pause(e){(isNullOrUndefined(e)||!0!==e)&&(e=!1),this.getHtml5QrcodeOrFail().pause(e)}resume(){this.getHtml5QrcodeOrFail().resume()}getState(){return this.getHtml5QrcodeOrFail().getState()}clear(){const e=()=>{const e=document.getElementById(this.elementId);e&&(e.innerHTML="",this.resetBasicLayout(e))};return this.html5Qrcode?new Promise(((t,a)=>{this.html5Qrcode?this.html5Qrcode.isScanning?this.html5Qrcode.stop().then((a=>{this.html5Qrcode?(this.html5Qrcode.clear(),e(),t()):t()})).catch((e=>{this.verbose&&this.logger.logError("Unable to stop qrcode scanner",e),a(e)})):(this.html5Qrcode.clear(),e()):t()})):Promise.resolve()}getRunningTrackCapabilities(){return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities()}getRunningTrackSettings(){return this.getHtml5QrcodeOrFail().getRunningTrackSettings()}applyVideoConstraints(e){return this.getHtml5QrcodeOrFail().applyVideoConstraints(e)}getHtml5QrcodeOrFail(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode}createConfig(e){return e?(e.fps||(e.fps=Html5QrcodeConstants.SCAN_DEFAULT_FPS),e.rememberLastUsedCamera!==!Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(e.rememberLastUsedCamera=Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED),e.supportedScanTypes||(e.supportedScanTypes=Html5QrcodeConstants.DEFAULT_SUPPORTED_SCAN_TYPE),e):{fps:Html5QrcodeConstants.SCAN_DEFAULT_FPS,rememberLastUsedCamera:Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED,supportedScanTypes:Html5QrcodeConstants.DEFAULT_SUPPORTED_SCAN_TYPE}}createBasicLayout(e){e.style.position="relative",e.style.padding="0px",e.style.border="1px solid silver",this.createHeader(e);const t=document.createElement("div"),a=this.getScanRegionId();t.id=a,t.style.width="100%",t.style.minHeight="100px",t.style.textAlign="center",e.appendChild(t),ScanTypeSelector.isCameraScanType(this.currentScanType)?this.insertCameraScanImageToScanRegion():this.insertFileScanImageToScanRegion();const n=document.createElement("div"),r=this.getDashboardId();n.id=r,n.style.width="100%",e.appendChild(n),this.setupInitialDashboard(n)}resetBasicLayout(e){e.style.border="none"}setupInitialDashboard(e){this.createSection(e),this.createSectionControlPanel(),this.scanTypeSelector.hasMoreThanOneScanType()&&this.createSectionSwap()}createHeader(e){const t=document.createElement("div");t.style.textAlign="left",t.style.margin="0px",e.appendChild(t),(new LibraryInfoContainer).renderInto(t);const a=document.createElement("div");a.id=this.getHeaderMessageContainerId(),a.style.display="none",a.style.textAlign="center",a.style.fontSize="14px",a.style.padding="2px 10px",a.style.margin="4px",a.style.borderTop="1px solid #f6f6f6",t.appendChild(a)}createSection(e){const t=document.createElement("div");t.id=this.getDashboardSectionId(),t.style.width="100%",t.style.padding="10px 0px 10px 0px",t.style.textAlign="left",e.appendChild(t)}createCameraListUi(e,t,a){const n=this;n.showHideScanTypeSwapLink(!1),n.setHeaderMessage(Html5QrcodeScannerStrings.cameraPermissionRequesting());const r=()=>{a||n.createPermissionButton(e,t)};Html5Qrcode.getCameras().then((a=>{n.persistedDataManager.setHasPermission(!0),n.showHideScanTypeSwapLink(!0),n.resetHeaderMessage(),a&&a.length>0?(e.removeChild(t),n.renderCameraSelection(a)):(n.setHeaderMessage(Html5QrcodeScannerStrings.noCameraFound(),Html5QrcodeScannerStatus.STATUS_WARNING),r())})).catch((e=>{n.persistedDataManager.setHasPermission(!1),a?a.disabled=!1:r(),n.setHeaderMessage(e,Html5QrcodeScannerStatus.STATUS_WARNING),n.showHideScanTypeSwapLink(!0)}))}createPermissionButton(e,t){const a=this,n=BaseUiElementFactory.createElement("button",this.getCameraPermissionButtonId());n.innerText=Html5QrcodeScannerStrings.cameraPermissionTitle(),n.addEventListener("click",(function(){n.disabled=!0,a.createCameraListUi(e,t,n)})),t.appendChild(n)}createPermissionsUi(e,t){const a=this;ScanTypeSelector.isCameraScanType(this.currentScanType)&&this.persistedDataManager.hasCameraPermissions()?CameraPermissions.hasPermissions().then((n=>{n?a.createCameraListUi(e,t):(a.persistedDataManager.setHasPermission(!1),a.createPermissionButton(e,t))})).catch((n=>{a.persistedDataManager.setHasPermission(!1),a.createPermissionButton(e,t)})):this.createPermissionButton(e,t)}createSectionControlPanel(){const e=document.getElementById(this.getDashboardSectionId()),t=document.createElement("div");e.appendChild(t);const a=document.createElement("div");a.id=this.getDashboardSectionCameraScanRegionId(),a.style.display=ScanTypeSelector.isCameraScanType(this.currentScanType)?"block":"none",t.appendChild(a);const n=document.createElement("div");n.style.textAlign="center",a.appendChild(n),this.scanTypeSelector.isCameraScanRequired()&&this.createPermissionsUi(a,n),this.renderFileScanUi(t)}renderFileScanUi(e){let t=ScanTypeSelector.isFileScanType(this.currentScanType);const a=this;this.fileSelectionUi=FileSelectionUi.create(e,t,(e=>{if(!a.html5Qrcode)throw"html5Qrcode not defined";ScanTypeSelector.isFileScanType(a.currentScanType)&&(a.setHeaderMessage(Html5QrcodeScannerStrings.loadingImage()),a.html5Qrcode.scanFileV2(e,!0).then((e=>{a.resetHeaderMessage(),a.qrCodeSuccessCallback(e.decodedText,e)})).catch((e=>{a.setHeaderMessage(e,Html5QrcodeScannerStatus.STATUS_WARNING),a.qrCodeErrorCallback(e,Html5QrcodeErrorFactory.createFrom(e))})))}))}renderCameraSelection(e){const t=this,a=document.getElementById(this.getDashboardSectionCameraScanRegionId());a.style.textAlign="center";let n=CameraZoomUi.create(a,!1);const r=e=>{let t=e.zoomFeature();if(!t.isSupported())return;n.setOnCameraZoomValueChangeCallback((e=>{t.apply(e)}));let a=1;this.config.defaultZoomValueIfSupported&&(a=this.config.defaultZoomValueIfSupported),a=clip(a,t.min(),t.max()),n.setValues(t.min(),t.max(),a,t.step()),n.show()};let s=CameraSelectionUi.create(a,e);const i=document.createElement("span"),o=BaseUiElementFactory.createElement("button",PublicUiElementIdAndClasses.CAMERA_START_BUTTON_ID);o.innerText=Html5QrcodeScannerStrings.scanButtonStartScanningText(),i.appendChild(o);const c=BaseUiElementFactory.createElement("button",PublicUiElementIdAndClasses.CAMERA_STOP_BUTTON_ID);let l;c.innerText=Html5QrcodeScannerStrings.scanButtonStopScanningText(),c.style.display="none",c.disabled=!0,i.appendChild(c);a.appendChild(i);const d=e=>{e||(o.style.display="none"),o.innerText=Html5QrcodeScannerStrings.scanButtonStartScanningText(),o.style.opacity="1",o.disabled=!1,e&&(o.style.display="inline-block")};if(o.addEventListener("click",(e=>{o.innerText=Html5QrcodeScannerStrings.scanButtonScanningStarting(),s.disable(),o.disabled=!0,o.style.opacity="0.5",this.scanTypeSelector.hasMoreThanOneScanType()&&t.showHideScanTypeSwapLink(!1),t.resetHeaderMessage();const a=s.getValue();t.persistedDataManager.setLastUsedCameraId(a),t.html5Qrcode.start(a,toHtml5QrcodeCameraScanConfig(t.config),t.qrCodeSuccessCallback,t.qrCodeErrorCallback).then((e=>{c.disabled=!1,c.style.display="inline-block",d(!1);const a=t.html5Qrcode.getRunningTrackCameraCapabilities();!0===this.config.showTorchButtonIfSupported&&(e=>{e.torchFeature().isSupported()?(l?l.updateTorchCapability(e.torchFeature()):l=TorchButton.create(i,e.torchFeature(),{display:"none",marginLeft:"5px"},(e=>{t.setHeaderMessage(e,Html5QrcodeScannerStatus.STATUS_WARNING)})),l.show()):l&&l.hide()})(a),!0===this.config.showZoomSliderIfSupported&&r(a)})).catch((e=>{t.showHideScanTypeSwapLink(!0),s.enable(),d(!0),t.setHeaderMessage(e,Html5QrcodeScannerStatus.STATUS_WARNING)}))})),s.hasSingleItem()&&o.click(),c.addEventListener("click",(e=>{if(!t.html5Qrcode)throw"html5Qrcode not defined";c.disabled=!0,t.html5Qrcode.stop().then((e=>{this.scanTypeSelector.hasMoreThanOneScanType()&&t.showHideScanTypeSwapLink(!0),s.enable(),o.disabled=!1,c.style.display="none",o.style.display="inline-block",l&&(l.reset(),l.hide()),n.removeOnCameraZoomValueChangeCallback(),n.hide(),t.insertCameraScanImageToScanRegion()})).catch((e=>{c.disabled=!1,t.setHeaderMessage(e,Html5QrcodeScannerStatus.STATUS_WARNING)}))})),t.persistedDataManager.getLastUsedCameraId()){const e=t.persistedDataManager.getLastUsedCameraId();s.hasValue(e)?(s.setValue(e),o.click()):t.persistedDataManager.resetLastUsedCameraId()}}createSectionSwap(){const e=this,t=Html5QrcodeScannerStrings.textIfCameraScanSelected(),a=Html5QrcodeScannerStrings.textIfFileScanSelected(),n=document.getElementById(this.getDashboardSectionId()),r=document.createElement("div");r.style.textAlign="center";const s=BaseUiElementFactory.createElement("a",this.getDashboardSectionSwapLinkId());s.style.textDecoration="underline",s.innerText=ScanTypeSelector.isCameraScanType(this.currentScanType)?t:a,s.addEventListener("click",(function(){e.sectionSwapAllowed?(e.resetHeaderMessage(),e.fileSelectionUi.resetValue(),e.sectionSwapAllowed=!1,ScanTypeSelector.isCameraScanType(e.currentScanType)?(e.clearScanRegion(),e.getCameraScanRegion().style.display="none",e.fileSelectionUi.show(),s.innerText=a,e.currentScanType=Html5QrcodeScanType.SCAN_TYPE_FILE,e.insertFileScanImageToScanRegion()):(e.clearScanRegion(),e.getCameraScanRegion().style.display="block",e.fileSelectionUi.hide(),s.innerText=t,e.currentScanType=Html5QrcodeScanType.SCAN_TYPE_CAMERA,e.insertCameraScanImageToScanRegion(),e.startCameraScanIfPermissionExistsOnSwap()),e.sectionSwapAllowed=!0):e.verbose&&e.logger.logError("Section swap called when not allowed")})),r.appendChild(s),n.appendChild(r)}startCameraScanIfPermissionExistsOnSwap(){const e=this;this.persistedDataManager.hasCameraPermissions()&&CameraPermissions.hasPermissions().then((t=>{if(t){let t=document.getElementById(e.getCameraPermissionButtonId());if(!t)throw this.logger.logError("Permission button not found, fail;"),"Permission button not found";t.click()}else e.persistedDataManager.setHasPermission(!1)})).catch((t=>{e.persistedDataManager.setHasPermission(!1)}))}resetHeaderMessage(){document.getElementById(this.getHeaderMessageContainerId()).style.display="none"}setHeaderMessage(e,t){t||(t=Html5QrcodeScannerStatus.STATUS_DEFAULT);const a=this.getHeaderMessageDiv();switch(a.innerText=e,a.style.display="block",t){case Html5QrcodeScannerStatus.STATUS_SUCCESS:a.style.background="rgba(106, 175, 80, 0.26)",a.style.color="#477735";break;case Html5QrcodeScannerStatus.STATUS_WARNING:a.style.background="rgba(203, 36, 49, 0.14)",a.style.color="#cb2431";break;case Html5QrcodeScannerStatus.STATUS_DEFAULT:default:a.style.background="rgba(0, 0, 0, 0)",a.style.color="rgb(17, 17, 17)"}}showHideScanTypeSwapLink(e){!0!==e&&(e=!1),this.sectionSwapAllowed=e,this.getDashboardSectionSwapLink().style.display=e?"inline-block":"none"}insertCameraScanImageToScanRegion(){const e=this,t=document.getElementById(this.getScanRegionId());if(this.cameraScanImage)return t.innerHTML="<br>",void t.appendChild(this.cameraScanImage);this.cameraScanImage=new Image,this.cameraScanImage.onload=a=>{t.innerHTML="<br>",t.appendChild(e.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src=ASSET_CAMERA_SCAN}insertFileScanImageToScanRegion(){const e=this,t=document.getElementById(this.getScanRegionId());if(this.fileScanImage)return t.innerHTML="<br>",void t.appendChild(this.fileScanImage);this.fileScanImage=new Image,this.fileScanImage.onload=a=>{t.innerHTML="<br>",t.appendChild(e.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src=ASSET_FILE_SCAN}clearScanRegion(){document.getElementById(this.getScanRegionId()).innerHTML=""}getDashboardSectionId(){return`${this.elementId}__dashboard_section`}getDashboardSectionCameraScanRegionId(){return`${this.elementId}__dashboard_section_csr`}getDashboardSectionSwapLinkId(){return PublicUiElementIdAndClasses.SCAN_TYPE_CHANGE_ANCHOR_ID}getScanRegionId(){return`${this.elementId}__scan_region`}getDashboardId(){return`${this.elementId}__dashboard`}getHeaderMessageContainerId(){return`${this.elementId}__header_message`}getCameraPermissionButtonId(){return PublicUiElementIdAndClasses.CAMERA_PERMISSION_BUTTON_ID}getCameraScanRegion(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())}getDashboardSectionSwapLink(){return document.getElementById(this.getDashboardSectionSwapLinkId())}getHeaderMessageDiv(){return document.getElementById(this.getHeaderMessageContainerId())}}
//# sourceMappingURL=/sm/583283a7b5ee805011c77fd769c195d83d97e05b62de8a659e97c69afe323ce8.map