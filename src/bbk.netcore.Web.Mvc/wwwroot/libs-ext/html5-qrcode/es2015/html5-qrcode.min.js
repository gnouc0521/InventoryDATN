/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/html5-qrcode@2.3.4/es2015/html5-qrcode.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{BaseLoggger,Html5QrcodeResultFactory,Html5QrcodeErrorFactory,Html5QrcodeSupportedFormats,isValidHtml5QrcodeSupportedFormats,Html5QrcodeConstants,isNullOrUndefined}from"./core";import{Html5QrcodeStrings}from"./strings";import{VideoConstraintsUtil}from"./utils";import{Html5QrcodeShim}from"./code-decoder";import{CameraFactory}from"./camera/factories";import{CameraRetriever}from"./camera/retriever";import{StateManagerFactory,Html5QrcodeScannerState}from"./state-manager";class Constants extends Html5QrcodeConstants{}Constants.DEFAULT_WIDTH=300,Constants.DEFAULT_WIDTH_OFFSET=2,Constants.FILE_SCAN_MIN_HEIGHT=300,Constants.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,Constants.MIN_QR_BOX_SIZE=50,Constants.SHADED_LEFT=1,Constants.SHADED_RIGHT=2,Constants.SHADED_TOP=3,Constants.SHADED_BOTTOM=4,Constants.SHADED_REGION_ELEMENT_ID="qr-shaded-region",Constants.VERBOSE=!1,Constants.BORDER_SHADER_DEFAULT_COLOR="#ffffff",Constants.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)";class InternalHtml5QrcodeConfig{constructor(e,t){this.logger=t,this.fps=Constants.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=!0===e.disableFlip,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=Constants.DEFAULT_DISABLE_FLIP}isMediaStreamConstraintsValid(){return this.videoConstraints?VideoConstraintsUtil.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)}isShadedBoxEnabled(){return!isNullOrUndefined(this.qrbox)}static create(e,t){return new InternalHtml5QrcodeConfig(e,t)}}export class Html5Qrcode{constructor(e,t){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw`HTML Element with id=${e} not found`;let r,n;this.elementId=e,this.verbose=!1,"boolean"==typeof t?this.verbose=!0===t:t&&(n=t,this.verbose=!0===n.verbose,r=n.experimentalFeatures),this.logger=new BaseLoggger(this.verbose),this.qrcode=new Html5QrcodeShim(this.getSupportedFormats(t),this.getUseBarCodeDetectorIfSupported(n),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=StateManagerFactory.create()}start(e,t,r,n){if(!e)throw"cameraIdOrConfig is required";if(!r||"function"!=typeof r)throw"qrCodeSuccessCallback is required and should be a function.";let s;s=n||(this.verbose?this.logger.log:()=>{});const i=InternalHtml5QrcodeConfig.create(t,this.logger);this.clearElement();let o=!1;i.videoConstraints&&(i.isMediaStreamConstraintsValid()?o=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));const a=o,d=document.getElementById(this.elementId);d.clientWidth?d.clientWidth:Constants.DEFAULT_WIDTH;d.style.position="relative",this.shouldScan=!0,this.element=d;const l=this,h=this.stateManagerProxy.startTransition(Html5QrcodeScannerState.SCANNING);return new Promise(((t,n)=>{const o=a?i.videoConstraints:l.createVideoConstraints(e);if(!o)return h.cancel(),void n("videoConstraints should be defined");let d={};a&&!i.aspectRatio||(d.aspectRatio=i.aspectRatio);let c={onRenderSurfaceReady:(e,t)=>{l.setupUi(e,t,i),l.isScanning=!0,l.foreverScan(i,r,s)}};CameraFactory.failIfNotSupported().then((e=>{e.create(o).then((e=>e.render(this.element,d,c).then((e=>{l.renderedCamera=e,h.execute(),t(null)})).catch((e=>{h.cancel(),n(e)})))).catch((e=>{h.cancel(),n(Html5QrcodeStrings.errorGettingUserMedia(e))}))})).catch((e=>{h.cancel(),n(Html5QrcodeStrings.cameraStreamingNotSupported())}))}))}pause(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(Html5QrcodeScannerState.PAUSED),this.showPausedState(),(isNullOrUndefined(e)||!0!==e)&&(e=!1),e&&this.renderedCamera&&this.renderedCamera.pause()}resume(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";const e=this,t=()=>{e.stateManagerProxy.directTransition(Html5QrcodeScannerState.SCANNING),e.hidePausedState()};this.renderedCamera.isPaused()?this.renderedCamera.resume((()=>{t()})):t()}getState(){return this.stateManagerProxy.getState()}stop(){if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";const e=this.stateManagerProxy.startTransition(Html5QrcodeScannerState.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);const t=()=>{if(!this.element)return;let e=document.getElementById(Constants.SHADED_REGION_ELEMENT_ID);e&&this.element.removeChild(e)};let r=this;return this.renderedCamera.close().then((()=>(r.renderedCamera=null,r.element&&(r.element.removeChild(r.canvasElement),r.canvasElement=null),t(),r.qrRegion&&(r.qrRegion=null),r.context&&(r.context=null),e.execute(),r.hidePausedState(),r.isScanning=!1,Promise.resolve())))}scanFile(e,t){return this.scanFileV2(e,t).then((e=>e.decodedText))}scanFileV2(e,t){if(!(e&&e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(isNullOrUndefined(t)&&(t=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(((r,n)=>{this.possiblyCloseLastScanImageFile(),this.clearElement(),this.lastScanImageFile=URL.createObjectURL(e);const s=new Image;s.onload=()=>{const e=s.width,i=s.height,o=document.getElementById(this.elementId),a=o.clientWidth?o.clientWidth:Constants.DEFAULT_WIDTH,d=Math.max(o.clientHeight?o.clientHeight:i,Constants.FILE_SCAN_MIN_HEIGHT),l=this.computeCanvasDrawConfig(e,i,a,d);if(t){const t=this.createCanvasElement(a,d,"qr-canvas-visible");t.style.display="inline-block",o.appendChild(t);const r=t.getContext("2d");if(!r)throw"Unable to get 2d context from canvas";r.canvas.width=a,r.canvas.height=d,r.drawImage(s,0,0,e,i,l.x,l.y,l.width,l.height)}let h=Constants.FILE_SCAN_HIDDEN_CANVAS_PADDING,c=Math.max(s.width,l.width),m=Math.max(s.height,l.height),g=c+2*h,u=m+2*h;const p=this.createCanvasElement(g,u);o.appendChild(p);const f=p.getContext("2d");if(!f)throw"Unable to get 2d context from canvas";f.canvas.width=g,f.canvas.height=u,f.drawImage(s,0,0,e,i,h,h,c,m);try{this.qrcode.decodeRobustlyAsync(p).then((e=>{r(Html5QrcodeResultFactory.createFromQrcodeResult(e))})).catch(n)}catch(e){n(`QR code parse error, error = ${e}`)}},s.onerror=n,s.onabort=n,s.onstalled=n,s.onsuspend=n,s.src=URL.createObjectURL(e)}))}clear(){this.clearElement()}static getCameras(){return CameraRetriever.retrieve()}getRunningTrackCapabilities(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()}getRunningTrackSettings(){return this.getRenderedCameraOrFail().getRunningTrackSettings()}getRunningTrackCameraCapabilities(){return this.getRenderedCameraOrFail().getCapabilities()}applyVideoConstraints(e){if(!e)throw"videoConstaints is required argument.";if(!VideoConstraintsUtil.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details";return this.getRenderedCameraOrFail().applyVideoConstraints(e)}getRenderedCameraOrFail(){if(null==this.renderedCamera)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera}getSupportedFormats(e){const t=[Html5QrcodeSupportedFormats.QR_CODE,Html5QrcodeSupportedFormats.AZTEC,Html5QrcodeSupportedFormats.CODABAR,Html5QrcodeSupportedFormats.CODE_39,Html5QrcodeSupportedFormats.CODE_93,Html5QrcodeSupportedFormats.CODE_128,Html5QrcodeSupportedFormats.DATA_MATRIX,Html5QrcodeSupportedFormats.MAXICODE,Html5QrcodeSupportedFormats.ITF,Html5QrcodeSupportedFormats.EAN_13,Html5QrcodeSupportedFormats.EAN_8,Html5QrcodeSupportedFormats.PDF_417,Html5QrcodeSupportedFormats.RSS_14,Html5QrcodeSupportedFormats.RSS_EXPANDED,Html5QrcodeSupportedFormats.UPC_A,Html5QrcodeSupportedFormats.UPC_E,Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION];if(!e||"boolean"==typeof e)return t;if(!e.formatsToSupport)return t;if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(0===e.formatsToSupport.length)throw"Atleast 1 formatsToSupport is needed.";const r=[];for(const t of e.formatsToSupport)isValidHtml5QrcodeSupportedFormats(t)?r.push(t):this.logger.warn(`Invalid format: ${t} passed in config, ignoring.`);if(0===r.length)throw"None of formatsToSupport match supported values.";return r}getUseBarCodeDetectorIfSupported(e){if(isNullOrUndefined(e))return!0;if(!isNullOrUndefined(e.useBarCodeDetectorIfSupported))return!1!==e.useBarCodeDetectorIfSupported;if(isNullOrUndefined(e.experimentalFeatures))return!0;let t=e.experimentalFeatures;return!!isNullOrUndefined(t.useBarCodeDetectorIfSupported)||!1!==t.useBarCodeDetectorIfSupported}validateQrboxSize(e,t,r){const n=r.qrbox;this.validateQrboxConfig(n);let s=this.toQrdimensions(e,t,n);const i=e=>{if(e<Constants.MIN_QR_BOX_SIZE)throw`minimum size of 'config.qrbox' dimension value is ${Constants.MIN_QR_BOX_SIZE}px.`};i(s.width),i(s.height),s.width=(t=>(t>e&&(this.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),t=e),t))(s.width)}validateQrboxConfig(e){if("number"!=typeof e&&"function"!=typeof e&&(void 0===e.width||void 0===e.height))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."}toQrdimensions(e,t,r){if("number"==typeof r)return{width:r,height:r};if("function"==typeof r)try{return r(e,t)}catch(e){throw new Error("qrbox config was passed as a function but it failed with unknown error"+e)}return r}setupUi(e,t,r){r.isShadedBoxEnabled()&&this.validateQrboxSize(e,t,r);const n=isNullOrUndefined(r.qrbox)?{width:e,height:t}:r.qrbox;this.validateQrboxConfig(n);let s=this.toQrdimensions(e,t,n);s.height>t&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");const i=r.isShadedBoxEnabled()&&s.height<=t,o={x:0,y:0,width:e,height:t},a=i?this.getShadedRegionBounds(e,t,s):o,d=this.createCanvasElement(a.width,a.height),l=d.getContext("2d",{willReadFrequently:!0});l.canvas.width=a.width,l.canvas.height=a.height,this.element.append(d),i&&this.possiblyInsertShadingElement(this.element,e,t,s),this.createScannerPausedUiElement(this.element),this.qrRegion=a,this.context=l,this.canvasElement=d}createScannerPausedUiElement(e){const t=document.createElement("div");t.innerText="Scanner paused",t.style.display="none",t.style.position="absolute",t.style.top="0px",t.style.zIndex="1",t.style.background="yellow",t.style.textAlign="center",t.style.width="100%",e.appendChild(t),this.scannerPausedUiElement=t}scanContext(e,t){return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then((t=>(e(t.text,Html5QrcodeResultFactory.createFromQrcodeResult(t)),this.possiblyUpdateShaders(!0),!0))).catch((e=>{this.possiblyUpdateShaders(!1);let r=Html5QrcodeStrings.codeParseError(e);return t(r,Html5QrcodeErrorFactory.createFrom(r)),!1}))}foreverScan(e,t,r){if(!this.shouldScan)return;if(!this.renderedCamera)return;const n=this.renderedCamera.getSurface(),s=n.videoWidth/n.clientWidth,i=n.videoHeight/n.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";const o=this.qrRegion.width*s,a=this.qrRegion.height*i,d=this.qrRegion.x*s,l=this.qrRegion.y*i;this.context.drawImage(n,d,l,o,a,0,0,this.qrRegion.width,this.qrRegion.height);const h=()=>{this.foreverScanTimeout=setTimeout((()=>{this.foreverScan(e,t,r)}),this.getTimeoutFps(e.fps))};this.scanContext(t,r).then((n=>{n||!0===e.disableFlip?h():(this.context.translate(this.context.canvas.width,0),this.context.scale(-1,1),this.scanContext(t,r).finally((()=>{h()})))})).catch((e=>{this.logger.logError("Error happend while scanning context",e),h()}))}createVideoConstraints(e){if("string"==typeof e)return{deviceId:{exact:e}};if("object"==typeof e){const t="facingMode",r="deviceId",n={user:!0,environment:!0},s="exact",i=e=>{if(e in n)return!0;throw`config has invalid 'facingMode' value = '${e}'`},o=Object.keys(e);if(1!==o.length)throw`'cameraIdOrConfig' object should have exactly 1 key, if passed as an object, found ${o.length} keys`;const a=Object.keys(e)[0];if(a!==t&&a!==r)throw`Only '${t}' and '${r}'  are supported for 'cameraIdOrConfig'`;if(a!==t){const t=e.deviceId;if("string"==typeof t)return{deviceId:t};if("object"==typeof t){if(s in t)return{deviceId:{exact:t[`${s}`]}};throw`'deviceId' should be string or object with ${s} as key.`}throw`Invalid type of 'deviceId' = ${typeof t}`}{const t=e.facingMode;if("string"==typeof t){if(i(t))return{facingMode:t}}else{if("object"!=typeof t){throw`Invalid type of 'facingMode' = ${typeof t}`}if(!(s in t))throw`'facingMode' should be string or object with ${s} as key.`;if(i(t[`${s}`]))return{facingMode:{exact:t[`${s}`]}}}}}throw`Invalid type of 'cameraIdOrConfig' = ${typeof e}`}computeCanvasDrawConfig(e,t,r,n){if(e<=r&&t<=n){return{x:(r-e)/2,y:(n-t)/2,width:e,height:t}}{const s=e,i=t;return e>r&&(t*=r/e,e=r),t>n&&(e*=n/t,t=n),this.logger.log(`Image downsampled from ${s}X${i} to ${e}X${t}.`),this.computeCanvasDrawConfig(e,t,r,n)}}clearElement(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";const e=document.getElementById(this.elementId);e&&(e.innerHTML="")}possiblyUpdateShaders(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach((t=>{t.style.backgroundColor=e?Constants.BORDER_SHADER_MATCH_COLOR:Constants.BORDER_SHADER_DEFAULT_COLOR})),this.qrMatch=e)}possiblyCloseLastScanImageFile(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)}createCanvasElement(e,t,r){const n=e,s=t,i=document.createElement("canvas");return i.style.width=`${n}px`,i.style.height=`${s}px`,i.style.display="none",i.id=isNullOrUndefined(r)?"qr-canvas":r,i}getShadedRegionBounds(e,t,r){if(r.width>e||r.height>t)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-r.width)/2,y:(t-r.height)/2,width:r.width,height:r.height}}possiblyInsertShadingElement(e,t,r,n){if(t-n.width<1||r-n.height<1)return;const s=document.createElement("div");s.style.position="absolute";const i=(t-n.width)/2,o=(r-n.height)/2;if(s.style.borderLeft=`${i}px solid rgba(0, 0, 0, 0.48)`,s.style.borderRight=`${i}px solid rgba(0, 0, 0, 0.48)`,s.style.borderTop=`${o}px solid rgba(0, 0, 0, 0.48)`,s.style.borderBottom=`${o}px solid rgba(0, 0, 0, 0.48)`,s.style.boxSizing="border-box",s.style.top="0px",s.style.bottom="0px",s.style.left="0px",s.style.right="0px",s.id=`${Constants.SHADED_REGION_ELEMENT_ID}`,t-n.width<11||r-n.height<11)this.hasBorderShaders=!1;else{const e=5,t=40;this.insertShaderBorders(s,t,e,-e,null,0,!0),this.insertShaderBorders(s,t,e,-e,null,0,!1),this.insertShaderBorders(s,t,e,null,-e,0,!0),this.insertShaderBorders(s,t,e,null,-e,0,!1),this.insertShaderBorders(s,e,t+e,-e,null,-e,!0),this.insertShaderBorders(s,e,t+e,null,-e,-e,!0),this.insertShaderBorders(s,e,t+e,-e,null,-e,!1),this.insertShaderBorders(s,e,t+e,null,-e,-e,!1),this.hasBorderShaders=!0}e.append(s)}insertShaderBorders(e,t,r,n,s,i,o){const a=document.createElement("div");a.style.position="absolute",a.style.backgroundColor=Constants.BORDER_SHADER_DEFAULT_COLOR,a.style.width=`${t}px`,a.style.height=`${r}px`,null!==n&&(a.style.top=`${n}px`),null!==s&&(a.style.bottom=`${s}px`),o?a.style.left=`${i}px`:a.style.right=`${i}px`,this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(a),e.appendChild(a)}showPausedState(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"}hidePausedState(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"}getTimeoutFps(e){return 1e3/e}}
//# sourceMappingURL=/sm/486c81174a47f1f5e5b8768c6f1d135589f5a8f55b1585c66a81344a1da90836.map