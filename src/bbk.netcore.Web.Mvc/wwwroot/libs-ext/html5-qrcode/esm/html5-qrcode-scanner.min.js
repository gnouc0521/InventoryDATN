/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/html5-qrcode@2.3.4/esm/html5-qrcode-scanner.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Html5QrcodeConstants,Html5QrcodeScanType,Html5QrcodeErrorFactory,BaseLoggger,isNullOrUndefined,clip}from"./core";import{Html5Qrcode}from"./html5-qrcode";import{Html5QrcodeScannerStrings}from"./strings";import{ASSET_FILE_SCAN,ASSET_CAMERA_SCAN}from"./image-assets";import{PersistedDataManager}from"./storage";import{LibraryInfoContainer}from"./ui";import{CameraPermissions}from"./camera/permissions";import{ScanTypeSelector}from"./ui/scanner/scan-type-selector";import{TorchButton}from"./ui/scanner/torch-button";import{FileSelectionUi}from"./ui/scanner/file-selection-ui";import{BaseUiElementFactory,PublicUiElementIdAndClasses}from"./ui/scanner/base";import{CameraSelectionUi}from"./ui/scanner/camera-selection-ui";import{CameraZoomUi}from"./ui/scanner/camera-zoom-ui";var Html5QrcodeScannerStatus;function toHtml5QrcodeCameraScanConfig(e){return{fps:e.fps,qrbox:e.qrbox,aspectRatio:e.aspectRatio,disableFlip:e.disableFlip,videoConstraints:e.videoConstraints}}function toHtml5QrcodeFullConfig(e,t){return{formatsToSupport:e.formatsToSupport,useBarCodeDetectorIfSupported:e.useBarCodeDetectorIfSupported,experimentalFeatures:e.experimentalFeatures,verbose:t}}!function(e){e[e.STATUS_DEFAULT=0]="STATUS_DEFAULT",e[e.STATUS_SUCCESS=1]="STATUS_SUCCESS",e[e.STATUS_WARNING=2]="STATUS_WARNING",e[e.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"}(Html5QrcodeScannerStatus||(Html5QrcodeScannerStatus={}));var Html5QrcodeScanner=function(){function e(e,t,n){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.fileSelectionUi=null,this.elementId=e,this.config=this.createConfig(t),this.verbose=!0===n,!document.getElementById(e))throw"HTML Element with id="+e+" not found";this.scanTypeSelector=new ScanTypeSelector(this.config.supportedScanTypes),this.currentScanType=this.scanTypeSelector.getDefaultScanType(),this.sectionSwapAllowed=!0,this.logger=new BaseLoggger(this.verbose),this.persistedDataManager=new PersistedDataManager,!0!==t.rememberLastUsedCamera&&this.persistedDataManager.reset()}return e.prototype.render=function(e,t){var n=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(t,a){if(e)e(t,a);else{if(n.lastMatchFound===t)return;n.lastMatchFound=t,n.setHeaderMessage(Html5QrcodeScannerStrings.lastMatch(t),Html5QrcodeScannerStatus.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(e,n){t&&t(e,n)};var a=document.getElementById(this.elementId);if(!a)throw"HTML Element with id="+this.elementId+" not found";a.innerHTML="",this.createBasicLayout(a),this.html5Qrcode=new Html5Qrcode(this.getScanRegionId(),toHtml5QrcodeFullConfig(this.config,this.verbose))},e.prototype.pause=function(e){(isNullOrUndefined(e)||!0!==e)&&(e=!1),this.getHtml5QrcodeOrFail().pause(e)},e.prototype.resume=function(){this.getHtml5QrcodeOrFail().resume()},e.prototype.getState=function(){return this.getHtml5QrcodeOrFail().getState()},e.prototype.clear=function(){var e=this,t=function(){var t=document.getElementById(e.elementId);t&&(t.innerHTML="",e.resetBasicLayout(t))};return this.html5Qrcode?new Promise((function(n,a){e.html5Qrcode?e.html5Qrcode.isScanning?e.html5Qrcode.stop().then((function(a){e.html5Qrcode?(e.html5Qrcode.clear(),t(),n()):n()})).catch((function(t){e.verbose&&e.logger.logError("Unable to stop qrcode scanner",t),a(t)})):(e.html5Qrcode.clear(),t()):n()})):Promise.resolve()},e.prototype.getRunningTrackCapabilities=function(){return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getHtml5QrcodeOrFail().getRunningTrackSettings()},e.prototype.applyVideoConstraints=function(e){return this.getHtml5QrcodeOrFail().applyVideoConstraints(e)},e.prototype.getHtml5QrcodeOrFail=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode},e.prototype.createConfig=function(e){return e?(e.fps||(e.fps=Html5QrcodeConstants.SCAN_DEFAULT_FPS),e.rememberLastUsedCamera!==!Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(e.rememberLastUsedCamera=Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED),e.supportedScanTypes||(e.supportedScanTypes=Html5QrcodeConstants.DEFAULT_SUPPORTED_SCAN_TYPE),e):{fps:Html5QrcodeConstants.SCAN_DEFAULT_FPS,rememberLastUsedCamera:Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED,supportedScanTypes:Html5QrcodeConstants.DEFAULT_SUPPORTED_SCAN_TYPE}},e.prototype.createBasicLayout=function(e){e.style.position="relative",e.style.padding="0px",e.style.border="1px solid silver",this.createHeader(e);var t=document.createElement("div"),n=this.getScanRegionId();t.id=n,t.style.width="100%",t.style.minHeight="100px",t.style.textAlign="center",e.appendChild(t),ScanTypeSelector.isCameraScanType(this.currentScanType)?this.insertCameraScanImageToScanRegion():this.insertFileScanImageToScanRegion();var a=document.createElement("div"),r=this.getDashboardId();a.id=r,a.style.width="100%",e.appendChild(a),this.setupInitialDashboard(a)},e.prototype.resetBasicLayout=function(e){e.style.border="none"},e.prototype.setupInitialDashboard=function(e){this.createSection(e),this.createSectionControlPanel(),this.scanTypeSelector.hasMoreThanOneScanType()&&this.createSectionSwap()},e.prototype.createHeader=function(e){var t=document.createElement("div");t.style.textAlign="left",t.style.margin="0px",e.appendChild(t),(new LibraryInfoContainer).renderInto(t);var n=document.createElement("div");n.id=this.getHeaderMessageContainerId(),n.style.display="none",n.style.textAlign="center",n.style.fontSize="14px",n.style.padding="2px 10px",n.style.margin="4px",n.style.borderTop="1px solid #f6f6f6",t.appendChild(n)},e.prototype.createSection=function(e){var t=document.createElement("div");t.id=this.getDashboardSectionId(),t.style.width="100%",t.style.padding="10px 0px 10px 0px",t.style.textAlign="left",e.appendChild(t)},e.prototype.createCameraListUi=function(e,t,n){var a=this;a.showHideScanTypeSwapLink(!1),a.setHeaderMessage(Html5QrcodeScannerStrings.cameraPermissionRequesting());var r=function(){n||a.createPermissionButton(e,t)};Html5Qrcode.getCameras().then((function(n){a.persistedDataManager.setHasPermission(!0),a.showHideScanTypeSwapLink(!0),a.resetHeaderMessage(),n&&n.length>0?(e.removeChild(t),a.renderCameraSelection(n)):(a.setHeaderMessage(Html5QrcodeScannerStrings.noCameraFound(),Html5QrcodeScannerStatus.STATUS_WARNING),r())})).catch((function(e){a.persistedDataManager.setHasPermission(!1),n?n.disabled=!1:r(),a.setHeaderMessage(e,Html5QrcodeScannerStatus.STATUS_WARNING),a.showHideScanTypeSwapLink(!0)}))},e.prototype.createPermissionButton=function(e,t){var n=this,a=BaseUiElementFactory.createElement("button",this.getCameraPermissionButtonId());a.innerText=Html5QrcodeScannerStrings.cameraPermissionTitle(),a.addEventListener("click",(function(){a.disabled=!0,n.createCameraListUi(e,t,a)})),t.appendChild(a)},e.prototype.createPermissionsUi=function(e,t){var n=this;ScanTypeSelector.isCameraScanType(this.currentScanType)&&this.persistedDataManager.hasCameraPermissions()?CameraPermissions.hasPermissions().then((function(a){a?n.createCameraListUi(e,t):(n.persistedDataManager.setHasPermission(!1),n.createPermissionButton(e,t))})).catch((function(a){n.persistedDataManager.setHasPermission(!1),n.createPermissionButton(e,t)})):this.createPermissionButton(e,t)},e.prototype.createSectionControlPanel=function(){var e=document.getElementById(this.getDashboardSectionId()),t=document.createElement("div");e.appendChild(t);var n=document.createElement("div");n.id=this.getDashboardSectionCameraScanRegionId(),n.style.display=ScanTypeSelector.isCameraScanType(this.currentScanType)?"block":"none",t.appendChild(n);var a=document.createElement("div");a.style.textAlign="center",n.appendChild(a),this.scanTypeSelector.isCameraScanRequired()&&this.createPermissionsUi(n,a),this.renderFileScanUi(t)},e.prototype.renderFileScanUi=function(e){var t=ScanTypeSelector.isFileScanType(this.currentScanType),n=this;this.fileSelectionUi=FileSelectionUi.create(e,t,(function(e){if(!n.html5Qrcode)throw"html5Qrcode not defined";ScanTypeSelector.isFileScanType(n.currentScanType)&&(n.setHeaderMessage(Html5QrcodeScannerStrings.loadingImage()),n.html5Qrcode.scanFileV2(e,!0).then((function(e){n.resetHeaderMessage(),n.qrCodeSuccessCallback(e.decodedText,e)})).catch((function(e){n.setHeaderMessage(e,Html5QrcodeScannerStatus.STATUS_WARNING),n.qrCodeErrorCallback(e,Html5QrcodeErrorFactory.createFrom(e))})))}))},e.prototype.renderCameraSelection=function(e){var t=this,n=this,a=document.getElementById(this.getDashboardSectionCameraScanRegionId());a.style.textAlign="center";var r=CameraZoomUi.create(a,!1),i=CameraSelectionUi.create(a,e),o=document.createElement("span"),s=BaseUiElementFactory.createElement("button",PublicUiElementIdAndClasses.CAMERA_START_BUTTON_ID);s.innerText=Html5QrcodeScannerStrings.scanButtonStartScanningText(),o.appendChild(s);var c,l=BaseUiElementFactory.createElement("button",PublicUiElementIdAndClasses.CAMERA_STOP_BUTTON_ID);l.innerText=Html5QrcodeScannerStrings.scanButtonStopScanningText(),l.style.display="none",l.disabled=!0,o.appendChild(l);a.appendChild(o);var d=function(e){e||(s.style.display="none"),s.innerText=Html5QrcodeScannerStrings.scanButtonStartScanningText(),s.style.opacity="1",s.disabled=!1,e&&(s.style.display="inline-block")};if(s.addEventListener("click",(function(e){s.innerText=Html5QrcodeScannerStrings.scanButtonScanningStarting(),i.disable(),s.disabled=!0,s.style.opacity="0.5",t.scanTypeSelector.hasMoreThanOneScanType()&&n.showHideScanTypeSwapLink(!1),n.resetHeaderMessage();var a=i.getValue();n.persistedDataManager.setLastUsedCameraId(a),n.html5Qrcode.start(a,toHtml5QrcodeCameraScanConfig(n.config),n.qrCodeSuccessCallback,n.qrCodeErrorCallback).then((function(e){l.disabled=!1,l.style.display="inline-block",d(!1);var a=n.html5Qrcode.getRunningTrackCameraCapabilities();!0===t.config.showTorchButtonIfSupported&&function(e){e.torchFeature().isSupported()?(c?c.updateTorchCapability(e.torchFeature()):c=TorchButton.create(o,e.torchFeature(),{display:"none",marginLeft:"5px"},(function(e){n.setHeaderMessage(e,Html5QrcodeScannerStatus.STATUS_WARNING)})),c.show()):c&&c.hide()}(a),!0===t.config.showZoomSliderIfSupported&&function(e){var n=e.zoomFeature();if(n.isSupported()){r.setOnCameraZoomValueChangeCallback((function(e){n.apply(e)}));var a=1;t.config.defaultZoomValueIfSupported&&(a=t.config.defaultZoomValueIfSupported),a=clip(a,n.min(),n.max()),r.setValues(n.min(),n.max(),a,n.step()),r.show()}}(a)})).catch((function(e){n.showHideScanTypeSwapLink(!0),i.enable(),d(!0),n.setHeaderMessage(e,Html5QrcodeScannerStatus.STATUS_WARNING)}))})),i.hasSingleItem()&&s.click(),l.addEventListener("click",(function(e){if(!n.html5Qrcode)throw"html5Qrcode not defined";l.disabled=!0,n.html5Qrcode.stop().then((function(e){t.scanTypeSelector.hasMoreThanOneScanType()&&n.showHideScanTypeSwapLink(!0),i.enable(),s.disabled=!1,l.style.display="none",s.style.display="inline-block",c&&(c.reset(),c.hide()),r.removeOnCameraZoomValueChangeCallback(),r.hide(),n.insertCameraScanImageToScanRegion()})).catch((function(e){l.disabled=!1,n.setHeaderMessage(e,Html5QrcodeScannerStatus.STATUS_WARNING)}))})),n.persistedDataManager.getLastUsedCameraId()){var S=n.persistedDataManager.getLastUsedCameraId();i.hasValue(S)?(i.setValue(S),s.click()):n.persistedDataManager.resetLastUsedCameraId()}},e.prototype.createSectionSwap=function(){var e=this,t=Html5QrcodeScannerStrings.textIfCameraScanSelected(),n=Html5QrcodeScannerStrings.textIfFileScanSelected(),a=document.getElementById(this.getDashboardSectionId()),r=document.createElement("div");r.style.textAlign="center";var i=BaseUiElementFactory.createElement("a",this.getDashboardSectionSwapLinkId());i.style.textDecoration="underline",i.innerText=ScanTypeSelector.isCameraScanType(this.currentScanType)?t:n,i.addEventListener("click",(function(){e.sectionSwapAllowed?(e.resetHeaderMessage(),e.fileSelectionUi.resetValue(),e.sectionSwapAllowed=!1,ScanTypeSelector.isCameraScanType(e.currentScanType)?(e.clearScanRegion(),e.getCameraScanRegion().style.display="none",e.fileSelectionUi.show(),i.innerText=n,e.currentScanType=Html5QrcodeScanType.SCAN_TYPE_FILE,e.insertFileScanImageToScanRegion()):(e.clearScanRegion(),e.getCameraScanRegion().style.display="block",e.fileSelectionUi.hide(),i.innerText=t,e.currentScanType=Html5QrcodeScanType.SCAN_TYPE_CAMERA,e.insertCameraScanImageToScanRegion(),e.startCameraScanIfPermissionExistsOnSwap()),e.sectionSwapAllowed=!0):e.verbose&&e.logger.logError("Section swap called when not allowed")})),r.appendChild(i),a.appendChild(r)},e.prototype.startCameraScanIfPermissionExistsOnSwap=function(){var e=this,t=this;this.persistedDataManager.hasCameraPermissions()&&CameraPermissions.hasPermissions().then((function(n){if(n){var a=document.getElementById(t.getCameraPermissionButtonId());if(!a)throw e.logger.logError("Permission button not found, fail;"),"Permission button not found";a.click()}else t.persistedDataManager.setHasPermission(!1)})).catch((function(e){t.persistedDataManager.setHasPermission(!1)}))},e.prototype.resetHeaderMessage=function(){document.getElementById(this.getHeaderMessageContainerId()).style.display="none"},e.prototype.setHeaderMessage=function(e,t){t||(t=Html5QrcodeScannerStatus.STATUS_DEFAULT);var n=this.getHeaderMessageDiv();switch(n.innerText=e,n.style.display="block",t){case Html5QrcodeScannerStatus.STATUS_SUCCESS:n.style.background="rgba(106, 175, 80, 0.26)",n.style.color="#477735";break;case Html5QrcodeScannerStatus.STATUS_WARNING:n.style.background="rgba(203, 36, 49, 0.14)",n.style.color="#cb2431";break;case Html5QrcodeScannerStatus.STATUS_DEFAULT:default:n.style.background="rgba(0, 0, 0, 0)",n.style.color="rgb(17, 17, 17)"}},e.prototype.showHideScanTypeSwapLink=function(e){!0!==e&&(e=!1),this.sectionSwapAllowed=e,this.getDashboardSectionSwapLink().style.display=e?"inline-block":"none"},e.prototype.insertCameraScanImageToScanRegion=function(){var e=this,t=document.getElementById(this.getScanRegionId());if(this.cameraScanImage)return t.innerHTML="<br>",void t.appendChild(this.cameraScanImage);this.cameraScanImage=new Image,this.cameraScanImage.onload=function(n){t.innerHTML="<br>",t.appendChild(e.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src=ASSET_CAMERA_SCAN},e.prototype.insertFileScanImageToScanRegion=function(){var e=this,t=document.getElementById(this.getScanRegionId());if(this.fileScanImage)return t.innerHTML="<br>",void t.appendChild(this.fileScanImage);this.fileScanImage=new Image,this.fileScanImage.onload=function(n){t.innerHTML="<br>",t.appendChild(e.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src=ASSET_FILE_SCAN},e.prototype.clearScanRegion=function(){document.getElementById(this.getScanRegionId()).innerHTML=""},e.prototype.getDashboardSectionId=function(){return this.elementId+"__dashboard_section"},e.prototype.getDashboardSectionCameraScanRegionId=function(){return this.elementId+"__dashboard_section_csr"},e.prototype.getDashboardSectionSwapLinkId=function(){return PublicUiElementIdAndClasses.SCAN_TYPE_CHANGE_ANCHOR_ID},e.prototype.getScanRegionId=function(){return this.elementId+"__scan_region"},e.prototype.getDashboardId=function(){return this.elementId+"__dashboard"},e.prototype.getHeaderMessageContainerId=function(){return this.elementId+"__header_message"},e.prototype.getCameraPermissionButtonId=function(){return PublicUiElementIdAndClasses.CAMERA_PERMISSION_BUTTON_ID},e.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},e.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},e.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())},e}();export{Html5QrcodeScanner};
//# sourceMappingURL=/sm/be2d97595191b4f14bdc6f9c38f9c9e3aa19414b791bba1ced7ccb54c8a75719.map