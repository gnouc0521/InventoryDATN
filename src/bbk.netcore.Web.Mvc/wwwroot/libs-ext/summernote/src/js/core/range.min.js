/**
 * Minified by jsDelivr using Terser v5.9.0.
 * Original file: /npm/summernote@0.8.20/src/js/core/range.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import $ from"jquery";import env from"./env";import func from"./func";import lists from"./lists";import dom from"./dom";function textRangeToPoint(t,e){let o,n=t.parentElement();const s=document.body.createTextRange();let i;const r=lists.from(n.childNodes);for(o=0;o<r.length;o++)if(!dom.isText(r[o])){if(s.moveToElementText(r[o]),s.compareEndPoints("StartToStart",t)>=0)break;i=r[o]}if(0!==o&&dom.isText(r[o-1])){const s=document.body.createTextRange();let r=null;s.moveToElementText(i||n),s.collapse(!i),r=i?i.nextSibling:n.firstChild;const d=t.duplicate();d.setEndPoint("StartToStart",s);let a=d.text.replace(/[\r\n]/g,"").length;for(;a>r.nodeValue.length&&r.nextSibling;)a-=r.nodeValue.length,r=r.nextSibling;r.nodeValue;e&&r.nextSibling&&dom.isText(r.nextSibling)&&a===r.nodeValue.length&&(a-=r.nodeValue.length,r=r.nextSibling),n=r,o=a}return{cont:n,offset:o}}function pointToTextRange(t){const e=function(t,o){let n,s;if(dom.isText(t)){const e=dom.listPrev(t,func.not(dom.isText)),i=lists.last(e).previousSibling;n=i||t.parentNode,o+=lists.sum(lists.tail(e),dom.nodeLength),s=!i}else{if(n=t.childNodes[o]||t,dom.isText(n))return e(n,0);o=0,s=!1}return{node:n,collapseToStart:s,offset:o}},o=document.body.createTextRange(),n=e(t.node,t.offset);return o.moveToElementText(n.node),o.collapse(n.collapseToStart),o.moveStart("character",n.offset),o}class WrappedRange{constructor(t,e,o,n){this.sc=t,this.so=e,this.ec=o,this.eo=n,this.isOnEditable=this.makeIsOn(dom.isEditable),this.isOnList=this.makeIsOn(dom.isList),this.isOnAnchor=this.makeIsOn(dom.isAnchor),this.isOnCell=this.makeIsOn(dom.isCell),this.isOnData=this.makeIsOn(dom.isData)}nativeRange(){if(env.isW3CRangeSupport){const t=document.createRange();return t.setStart(this.sc,this.so),t.setEnd(this.ec,this.eo),t}{const t=pointToTextRange({node:this.sc,offset:this.so});return t.setEndPoint("EndToEnd",pointToTextRange({node:this.ec,offset:this.eo})),t}}getPoints(){return{sc:this.sc,so:this.so,ec:this.ec,eo:this.eo}}getStartPoint(){return{node:this.sc,offset:this.so}}getEndPoint(){return{node:this.ec,offset:this.eo}}select(){const t=this.nativeRange();if(env.isW3CRangeSupport){const e=document.getSelection();e.rangeCount>0&&e.removeAllRanges(),e.addRange(t)}else t.select();return this}scrollIntoView(t){const e=$(t).height();return t.scrollTop+e<this.sc.offsetTop&&(t.scrollTop+=Math.abs(t.scrollTop+e-this.sc.offsetTop)),this}normalize(){const t=function(t,e){if(!t)return t;if(dom.isVisiblePoint(t)&&(!dom.isEdgePoint(t)||dom.isRightEdgePoint(t)&&!e||dom.isLeftEdgePoint(t)&&e||dom.isRightEdgePoint(t)&&e&&dom.isVoid(t.node.nextSibling)||dom.isLeftEdgePoint(t)&&!e&&dom.isVoid(t.node.previousSibling)||dom.isBlock(t.node)&&dom.isEmpty(t.node)))return t;const o=dom.ancestor(t.node,dom.isBlock);let n=!1;if(!n){const s=dom.prevPoint(t)||{node:null};n=(dom.isLeftEdgePointOf(t,o)||dom.isVoid(s.node))&&!e}let s=!1;if(!s){const n=dom.nextPoint(t)||{node:null};s=(dom.isRightEdgePointOf(t,o)||dom.isVoid(n.node))&&e}if(n||s){if(dom.isVisiblePoint(t))return t;e=!e}return(e?dom.nextPointUntil(dom.nextPoint(t),dom.isVisiblePoint):dom.prevPointUntil(dom.prevPoint(t),dom.isVisiblePoint))||t},e=t(this.getEndPoint(),!1),o=this.isCollapsed()?e:t(this.getStartPoint(),!0);return new WrappedRange(o.node,o.offset,e.node,e.offset)}nodes(t,e){t=t||func.ok;const o=e&&e.includeAncestor,n=e&&e.fullyContains,s=this.getStartPoint(),i=this.getEndPoint(),r=[],d=[];return dom.walkPoint(s,i,(function(e){if(dom.isEditable(e.node))return;let s;n?(dom.isLeftEdgePoint(e)&&d.push(e.node),dom.isRightEdgePoint(e)&&lists.contains(d,e.node)&&(s=e.node)):s=o?dom.ancestor(e.node,t):e.node,s&&t(s)&&r.push(s)}),!0),lists.unique(r)}commonAncestor(){return dom.commonAncestor(this.sc,this.ec)}expand(t){const e=dom.ancestor(this.sc,t),o=dom.ancestor(this.ec,t);if(!e&&!o)return new WrappedRange(this.sc,this.so,this.ec,this.eo);const n=this.getPoints();return e&&(n.sc=e,n.so=0),o&&(n.ec=o,n.eo=dom.nodeLength(o)),new WrappedRange(n.sc,n.so,n.ec,n.eo)}collapse(t){return t?new WrappedRange(this.sc,this.so,this.sc,this.so):new WrappedRange(this.ec,this.eo,this.ec,this.eo)}splitText(){const t=this.sc===this.ec,e=this.getPoints();return dom.isText(this.ec)&&!dom.isEdgePoint(this.getEndPoint())&&this.ec.splitText(this.eo),dom.isText(this.sc)&&!dom.isEdgePoint(this.getStartPoint())&&(e.sc=this.sc.splitText(this.so),e.so=0,t&&(e.ec=e.sc,e.eo=this.eo-this.so)),new WrappedRange(e.sc,e.so,e.ec,e.eo)}deleteContents(){if(this.isCollapsed())return this;const t=this.splitText(),e=t.nodes(null,{fullyContains:!0}),o=dom.prevPointUntil(t.getStartPoint(),(function(t){return!lists.contains(e,t.node)})),n=[];return $.each(e,(function(t,e){const s=e.parentNode;o.node!==s&&1===dom.nodeLength(s)&&n.push(s),dom.remove(e,!1)})),$.each(n,(function(t,e){dom.remove(e,!1)})),new WrappedRange(o.node,o.offset,o.node,o.offset).normalize()}makeIsOn(t){return function(){const e=dom.ancestor(this.sc,t);return!!e&&e===dom.ancestor(this.ec,t)}}isLeftEdgeOf(t){if(!dom.isLeftEdgePoint(this.getStartPoint()))return!1;const e=dom.ancestor(this.sc,t);return e&&dom.isLeftEdgeOf(this.sc,e)}isCollapsed(){return this.sc===this.ec&&this.so===this.eo}wrapBodyInlineWithPara(){if(dom.isBodyContainer(this.sc)&&dom.isEmpty(this.sc))return this.sc.innerHTML=dom.emptyPara,new WrappedRange(this.sc.firstChild,0,this.sc.firstChild,0);const t=this.normalize();if(dom.isParaInline(this.sc)||dom.isPara(this.sc))return t;let e;if(dom.isInline(t.sc)){const o=dom.listAncestor(t.sc,func.not(dom.isInline));e=lists.last(o),dom.isInline(e)||(e=o[o.length-2]||t.sc.childNodes[t.so])}else e=t.sc.childNodes[t.so>0?t.so-1:0];if(e){let t=dom.listPrev(e,dom.isParaInline).reverse();if(t=t.concat(dom.listNext(e.nextSibling,dom.isParaInline)),t.length){const e=dom.wrap(lists.head(t),"p");dom.appendChildNodes(e,lists.tail(t))}}return this.normalize()}insertNode(t){let e=this;(dom.isText(t)||dom.isInline(t))&&(e=this.wrapBodyInlineWithPara().deleteContents());const o=dom.splitPoint(e.getStartPoint(),dom.isInline(t));return o.rightNode?(o.rightNode.parentNode.insertBefore(t,o.rightNode),dom.isEmpty(o.rightNode)&&dom.isPara(t)&&o.rightNode.parentNode.removeChild(o.rightNode)):o.container.appendChild(t),t}pasteHTML(t){t=$.trim(t);const e=$("<div></div>").html(t)[0];let o=lists.from(e.childNodes);const n=this;let s=!1;return n.so>=0&&(o=o.reverse(),s=!0),o=o.map((function(t){return n.insertNode(t)})),s&&(o=o.reverse()),o}toString(){const t=this.nativeRange();return env.isW3CRangeSupport?t.toString():t.text}getWordRange(t){let e=this.getEndPoint();if(!dom.isCharPoint(e))return this;const o=dom.prevPointUntil(e,(function(t){return!dom.isCharPoint(t)}));return t&&(e=dom.nextPointUntil(e,(function(t){return!dom.isCharPoint(t)}))),new WrappedRange(o.node,o.offset,e.node,e.offset)}getWordsRange(t){var e=this.getEndPoint(),o=function(t){return!dom.isCharPoint(t)&&!dom.isSpacePoint(t)};if(o(e))return this;var n=dom.prevPointUntil(e,o);return t&&(e=dom.nextPointUntil(e,o)),new WrappedRange(n.node,n.offset,e.node,e.offset)}getWordsMatchRange(t){var e=this.getEndPoint(),o=dom.prevPointUntil(e,(function(o){if(!dom.isCharPoint(o)&&!dom.isSpacePoint(o))return!0;var n=new WrappedRange(o.node,o.offset,e.node,e.offset),s=t.exec(n.toString());return s&&0===s.index})),n=new WrappedRange(o.node,o.offset,e.node,e.offset),s=n.toString(),i=t.exec(s);return i&&i[0].length===s.length?n:null}bookmark(t){return{s:{path:dom.makeOffsetPath(t,this.sc),offset:this.so},e:{path:dom.makeOffsetPath(t,this.ec),offset:this.eo}}}paraBookmark(t){return{s:{path:lists.tail(dom.makeOffsetPath(lists.head(t),this.sc)),offset:this.so},e:{path:lists.tail(dom.makeOffsetPath(lists.last(t),this.ec)),offset:this.eo}}}getClientRects(){return this.nativeRange().getClientRects()}}export default{create:function(t,e,o,n){if(4===arguments.length)return new WrappedRange(t,e,o,n);if(2===arguments.length)return new WrappedRange(t,e,o=t,n=e);{let t=this.createFromSelection();if(!t&&1===arguments.length){let t=arguments[0];return dom.isEditable(t)&&(t=t.lastChild),this.createFromBodyElement(t,dom.emptyPara===arguments[0].innerHTML)}return t}},createFromBodyElement:function(t,e=!1){return this.createFromNode(t).collapse(e)},createFromSelection:function(){let t,e,o,n;if(env.isW3CRangeSupport){const s=document.getSelection();if(!s||0===s.rangeCount)return null;if(dom.isBody(s.anchorNode))return null;const i=s.getRangeAt(0);t=i.startContainer,e=i.startOffset,o=i.endContainer,n=i.endOffset}else{const s=document.selection.createRange(),i=s.duplicate();i.collapse(!1);const r=s;r.collapse(!0);let d=textRangeToPoint(r,!0),a=textRangeToPoint(i,!1);dom.isText(d.node)&&dom.isLeftEdgePoint(d)&&dom.isTextNode(a.node)&&dom.isRightEdgePoint(a)&&a.node.nextSibling===d.node&&(d=a),t=d.cont,e=d.offset,o=a.cont,n=a.offset}return new WrappedRange(t,e,o,n)},createFromNode:function(t){let e=t,o=0,n=t,s=dom.nodeLength(n);return dom.isVoid(e)&&(o=dom.listPrev(e).length-1,e=e.parentNode),dom.isBR(n)?(s=dom.listPrev(n).length-1,n=n.parentNode):dom.isVoid(n)&&(s=dom.listPrev(n).length,n=n.parentNode),this.create(e,o,n,s)},createFromNodeBefore:function(t){return this.createFromNode(t).collapse(!0)},createFromNodeAfter:function(t){return this.createFromNode(t).collapse()},createFromBookmark:function(t,e){const o=dom.fromOffsetPath(t,e.s.path),n=e.s.offset,s=dom.fromOffsetPath(t,e.e.path),i=e.e.offset;return new WrappedRange(o,n,s,i)},createFromParaBookmark:function(t,e){const o=t.s.offset,n=t.e.offset,s=dom.fromOffsetPath(lists.head(e),t.s.path),i=dom.fromOffsetPath(lists.last(e),t.e.path);return new WrappedRange(s,o,i,n)}};
//# sourceMappingURL=/sm/1a81d95b7c2cd1116396912572bfe14a32c81c03854198977dab609f76d65e48.map