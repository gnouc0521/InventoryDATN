/**
 * Minified by jsDelivr using Terser v5.9.0.
 * Original file: /npm/summernote@0.8.20/src/js/editing/Table.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import $ from"jquery";import dom from"../core/dom";import range from"../core/range";import lists from"../core/lists";const TableResultAction=function(e,t,o,n){const l={colPos:0,rowPos:0},s=[],r=[];function c(e,t,o,n,l,r,c){const a={baseRow:o,baseCell:n,isRowSpan:l,isColSpan:r,isVirtual:c};s[e]||(s[e]=[]),s[e][t]=a}function a(e,t,o,n){return{baseCell:e.baseCell,action:t,virtualTable:{rowIndex:o,cellIndex:n}}}function i(e,t){if(!s[e])return t;if(!s[e][t])return t;let o=t;for(;s[e][o];)if(o++,!s[e][o])return o}function u(e,t){const o=i(e.rowIndex,t.cellIndex),n=t.colSpan>1,s=t.rowSpan>1,r=e.rowIndex===l.rowPos&&t.cellIndex===l.colPos;c(e.rowIndex,o,e,t,s,n,!1);const a=t.attributes.rowSpan?parseInt(t.attributes.rowSpan.value,10):0;if(a>1)for(let l=1;l<a;l++){const s=e.rowIndex+l;b(s,o,t,r),c(s,o,e,t,!0,n,!0)}const u=t.attributes.colSpan?parseInt(t.attributes.colSpan.value,10):0;if(u>1)for(let n=1;n<u;n++){const l=i(e.rowIndex,o+n);b(e.rowIndex,l,t,r),c(e.rowIndex,l,e,t,s,!0,!0)}}function b(e,t,o,n){e===l.rowPos&&l.colPos>=o.cellIndex&&o.cellIndex<=t&&!n&&l.colPos++}function d(e){switch(t){case TableResultAction.where.Column:if(e.isColSpan)return TableResultAction.resultAction.SubtractSpanCount;break;case TableResultAction.where.Row:if(!e.isVirtual&&e.isRowSpan)return TableResultAction.resultAction.AddCell;if(e.isRowSpan)return TableResultAction.resultAction.SubtractSpanCount}return TableResultAction.resultAction.RemoveCell}function A(e){switch(t){case TableResultAction.where.Column:if(e.isColSpan)return TableResultAction.resultAction.SumSpanCount;if(e.isRowSpan&&e.isVirtual)return TableResultAction.resultAction.Ignore;break;case TableResultAction.where.Row:if(e.isRowSpan)return TableResultAction.resultAction.SumSpanCount;if(e.isColSpan&&e.isVirtual)return TableResultAction.resultAction.Ignore}return TableResultAction.resultAction.AddCell}this.getActionList=function(){const e=t===TableResultAction.where.Row?l.rowPos:-1,n=t===TableResultAction.where.Column?l.colPos:-1;let c=0,i=!0;for(;i;){const t=e>=0?e:c,l=n>=0?n:c,u=s[t];if(!u)return i=!1,r;const b=u[l];if(!b)return i=!1,r;let m=TableResultAction.resultAction.Ignore;switch(o){case TableResultAction.requestAction.Add:m=A(b);break;case TableResultAction.requestAction.Delete:m=d(b)}r.push(a(b,m,t,l)),c++}return r},e&&e.tagName&&("td"===e.tagName.toLowerCase()||"th"===e.tagName.toLowerCase())&&(l.colPos=e.cellIndex,e.parentElement&&e.parentElement.tagName&&"tr"===e.parentElement.tagName.toLowerCase()&&(l.rowPos=e.parentElement.rowIndex)),function(){const e=n.rows;for(let t=0;t<e.length;t++){const o=e[t].cells;for(let n=0;n<o.length;n++)u(e[t],o[n])}}()};TableResultAction.where={Row:0,Column:1},TableResultAction.requestAction={Add:0,Delete:1},TableResultAction.resultAction={Ignore:0,SubtractSpanCount:1,RemoveCell:2,AddCell:3,SumSpanCount:4};export default class Table{tab(e,t){const o=dom.ancestor(e.commonAncestor(),dom.isCell),n=dom.ancestor(o,dom.isTable),l=dom.listDescendant(n,dom.isCell),s=lists[t?"prev":"next"](l,o);s&&range.create(s,0).select()}addRow(e,t){const o=dom.ancestor(e.commonAncestor(),dom.isCell),n=$(o).closest("tr"),l=this.recoverAttributes(n),s=$("<tr"+l+"></tr>"),r=new TableResultAction(o,TableResultAction.where.Row,TableResultAction.requestAction.Add,$(n).closest("table")[0]).getActionList();for(let e=0;e<r.length;e++){const o=r[e],l=this.recoverAttributes(o.baseCell);switch(o.action){case TableResultAction.resultAction.AddCell:s.append("<td"+l+">"+dom.blank+"</td>");break;case TableResultAction.resultAction.SumSpanCount:{if("top"===t){if((o.baseCell.parent?o.baseCell.closest("tr").rowIndex:0)<=n[0].rowIndex){const e=$("<div></div>").append($("<td"+l+">"+dom.blank+"</td>").removeAttr("rowspan")).html();s.append(e);break}}let e=parseInt(o.baseCell.rowSpan,10);e++,o.baseCell.setAttribute("rowSpan",e)}}}if("top"===t)n.before(s);else{if(o.rowSpan>1){const e=n[0].rowIndex+(o.rowSpan-2);return void $($(n).parent().find("tr")[e]).after($(s))}n.after(s)}}addCol(e,t){const o=dom.ancestor(e.commonAncestor(),dom.isCell),n=$(o).closest("tr");$(n).siblings().push(n);const l=new TableResultAction(o,TableResultAction.where.Column,TableResultAction.requestAction.Add,$(n).closest("table")[0]).getActionList();for(let e=0;e<l.length;e++){const o=l[e],n=this.recoverAttributes(o.baseCell);switch(o.action){case TableResultAction.resultAction.AddCell:"right"===t?$(o.baseCell).after("<td"+n+">"+dom.blank+"</td>"):$(o.baseCell).before("<td"+n+">"+dom.blank+"</td>");break;case TableResultAction.resultAction.SumSpanCount:if("right"===t){let e=parseInt(o.baseCell.colSpan,10);e++,o.baseCell.setAttribute("colSpan",e)}else $(o.baseCell).before("<td"+n+">"+dom.blank+"</td>")}}}recoverAttributes(e){let t="";if(!e)return t;const o=e.attributes||[];for(let e=0;e<o.length;e++)"id"!==o[e].name.toLowerCase()&&o[e].specified&&(t+=" "+o[e].name+"='"+o[e].value+"'");return t}deleteRow(e){const t=dom.ancestor(e.commonAncestor(),dom.isCell),o=$(t).closest("tr"),n=o.children("td, th").index($(t)),l=o[0].rowIndex,s=new TableResultAction(t,TableResultAction.where.Row,TableResultAction.requestAction.Delete,$(o).closest("table")[0]).getActionList();for(let e=0;e<s.length;e++){if(!s[e])continue;const t=s[e].baseCell,r=s[e].virtualTable,c=t.rowSpan&&t.rowSpan>1;let a=c?parseInt(t.rowSpan,10):0;switch(s[e].action){case TableResultAction.resultAction.Ignore:continue;case TableResultAction.resultAction.AddCell:{const e=o.next("tr")[0];if(!e)continue;const t=o[0].cells[n];c&&(a>2?(a--,e.insertBefore(t,e.cells[n]),e.cells[n].setAttribute("rowSpan",a),e.cells[n].innerHTML=""):2===a&&(e.insertBefore(t,e.cells[n]),e.cells[n].removeAttribute("rowSpan"),e.cells[n].innerHTML=""))}continue;case TableResultAction.resultAction.SubtractSpanCount:c&&(a>2?(a--,t.setAttribute("rowSpan",a),r.rowIndex!==l&&t.cellIndex===n&&(t.innerHTML="")):2===a&&(t.removeAttribute("rowSpan"),r.rowIndex!==l&&t.cellIndex===n&&(t.innerHTML="")));continue;case TableResultAction.resultAction.RemoveCell:continue}}o.remove()}deleteCol(e){const t=dom.ancestor(e.commonAncestor(),dom.isCell),o=$(t).closest("tr"),n=o.children("td, th").index($(t)),l=new TableResultAction(t,TableResultAction.where.Column,TableResultAction.requestAction.Delete,$(o).closest("table")[0]).getActionList();for(let e=0;e<l.length;e++)if(l[e])switch(l[e].action){case TableResultAction.resultAction.Ignore:continue;case TableResultAction.resultAction.SubtractSpanCount:{const t=l[e].baseCell;if(t.colSpan&&t.colSpan>1){let e=t.colSpan?parseInt(t.colSpan,10):0;e>2?(e--,t.setAttribute("colSpan",e),t.cellIndex===n&&(t.innerHTML="")):2===e&&(t.removeAttribute("colSpan"),t.cellIndex===n&&(t.innerHTML=""))}}continue;case TableResultAction.resultAction.RemoveCell:dom.remove(l[e].baseCell,!0);continue}}createTable(e,t,o){const n=[];let l;for(let t=0;t<e;t++)n.push("<td>"+dom.blank+"</td>");l=n.join("");const s=[];let r;for(let e=0;e<t;e++)s.push("<tr>"+l+"</tr>");r=s.join("");const c=$("<table>"+r+"</table>");return o&&o.tableClassName&&c.addClass(o.tableClassName),c[0]}deleteTable(e){const t=dom.ancestor(e.commonAncestor(),dom.isCell);$(t).closest("table").remove()}}
//# sourceMappingURL=/sm/46eb7b53c5c8ad7b2b8f25e466a2942f074b5995406b5da79920d50592281f36.map