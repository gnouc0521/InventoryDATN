/**
 * Minified by jsDelivr using Terser v5.9.0.
 * Original file: /npm/summernote@0.8.20/src/js/module/HintPopover.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import $ from"jquery";import func from"../core/func";import lists from"../core/lists";import dom from"../core/dom";import range from"../core/range";import key from"../core/key";const POPOVER_DIST=5;export default class HintPopover{constructor(t){this.context=t,this.ui=$.summernote.ui,this.$editable=t.layoutInfo.editable,this.options=t.options,this.hint=this.options.hint||[],this.direction=this.options.hintDirection||"bottom",this.hints=Array.isArray(this.hint)?this.hint:[this.hint],this.events={"summernote.keyup":(t,e)=>{e.isDefaultPrevented()||this.handleKeyup(e)},"summernote.keydown":(t,e)=>{this.handleKeydown(e)},"summernote.disable summernote.dialog.shown summernote.blur":()=>{this.hide()}}}shouldInitialize(){return this.hints.length>0}initialize(){this.lastWordRange=null,this.matchingWord=null,this.$popover=this.ui.popover({className:"note-hint-popover",hideArrow:!0,direction:""}).render().appendTo(this.options.container),this.$popover.hide(),this.$content=this.$popover.find(".popover-content,.note-popover-content"),this.$content.on("click",".note-hint-item",(t=>{this.$content.find(".active").removeClass("active"),$(t.currentTarget).addClass("active"),this.replace()})),this.$popover.on("mousedown",(t=>{t.preventDefault()}))}destroy(){this.$popover.remove()}selectItem(t){this.$content.find(".active").removeClass("active"),t.addClass("active"),this.$content[0].scrollTop=t[0].offsetTop-this.$content.innerHeight()/2}moveDown(){const t=this.$content.find(".note-hint-item.active"),e=t.next();if(e.length)this.selectItem(e);else{let e=t.parent().next();e.length||(e=this.$content.find(".note-hint-group").first()),this.selectItem(e.find(".note-hint-item").first())}}moveUp(){const t=this.$content.find(".note-hint-item.active"),e=t.prev();if(e.length)this.selectItem(e);else{let e=t.parent().prev();e.length||(e=this.$content.find(".note-hint-group").last()),this.selectItem(e.find(".note-hint-item").last())}}replace(){const t=this.$content.find(".note-hint-item.active");if(t.length){var e=this.nodeFromItem(t);if(null!==this.matchingWord&&0===this.matchingWord.length)this.lastWordRange.so=this.lastWordRange.eo;else if(null!==this.matchingWord&&this.matchingWord.length>0&&!this.lastWordRange.isCollapsed()){let t=this.lastWordRange.eo-this.lastWordRange.so-this.matchingWord.length;t>0&&(this.lastWordRange.so+=t)}if(this.lastWordRange.insertNode(e),"next"===this.options.hintSelect){var i=document.createTextNode("");$(e).after(i),range.createFromNodeBefore(i).select()}else range.createFromNodeAfter(e).select();this.lastWordRange=null,this.hide(),this.context.invoke("editor.focus"),this.context.triggerEvent("change",this.$editable.html(),this.$editable)}}nodeFromItem(t){const e=this.hints[t.data("index")],i=t.data("item");let o=e.content?e.content(i):i;return"string"==typeof o&&(o=dom.createText(o)),o}createItemTemplates(t,e){const i=this.hints[t];return e.map((e=>{const o=$('<div class="note-hint-item"></div>');return o.append(i.template?i.template(e):e+""),o.data({index:t,item:e}),o}))}handleKeydown(t){this.$popover.is(":visible")&&(t.keyCode===key.code.ENTER?(t.preventDefault(),this.replace()):t.keyCode===key.code.UP?(t.preventDefault(),this.moveUp()):t.keyCode===key.code.DOWN&&(t.preventDefault(),this.moveDown()))}searchKeyword(t,e,i){const o=this.hints[t];if(o&&o.match.test(e)&&o.search){const t=o.match.exec(e);this.matchingWord=t[0],o.search(t[1],i)}else i()}createGroup(t,e){const i=$('<div class="note-hint-group note-hint-group-'+t+'"></div>');return this.searchKeyword(t,e,(e=>{(e=e||[]).length&&(i.html(this.createItemTemplates(t,e)),this.show())})),i}handleKeyup(t){if(!lists.contains([key.code.ENTER,key.code.UP,key.code.DOWN],t.keyCode)){let t,e,i=this.context.invoke("editor.getLastRange");if("words"===this.options.hintMode){if(t=i.getWordsRange(i),e=t.toString(),this.hints.forEach((o=>{if(o.match.test(e))return t=i.getWordsMatchRange(o.match),!1})),!t)return void this.hide();e=t.toString()}else t=i.getWordRange(),e=t.toString();if(this.hints.length&&e){this.$content.empty();const i=func.rect2bnd(lists.last(t.getClientRects())),o=$(this.options.container).offset();i&&(i.top-=o.top,i.left-=o.left,this.$popover.hide(),this.lastWordRange=t,this.hints.forEach(((t,i)=>{t.match.test(e)&&this.createGroup(i,e).appendTo(this.$content)})),this.$content.find(".note-hint-item:first").addClass("active"),"top"===this.direction?this.$popover.css({left:i.left,top:i.top-this.$popover.outerHeight()-5}):this.$popover.css({left:i.left,top:i.top+i.height+5}))}else this.hide()}}show(){this.$popover.show()}hide(){this.$popover.hide()}}
//# sourceMappingURL=/sm/333e9c11edde3e1c2b8dece4e638b27d460231c57589061bbf9d0f9f020333dc.map