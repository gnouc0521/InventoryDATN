(function(){function o(){f.ajax.reload()}function s(){e.ajax.reload()}var i=$("#AllRequestTable"),r=$("#AllRequestTableDone"),n=abp.services.app.purchasesSynthesise,u=new app.ModalManager({viewUrl:abp.appPath+"Inventorys/PurchaseAssignment/ViewPurchaseAssignment",scriptUrl:abp.appPath+"view-resources/Areas/Oms/PurchaseAssignments/ViewPurchaseAssignment.js",modalClass:"ViewModal",modalType:"modal-xl"}),t=function(){let n;return n},f=i.DataTable({paging:!0,serverSide:!1,processing:!0,searching:!1,language:{emptyTable:"Không tìm thấy dữ liệu",lengthMenu:"Hiển thị _MENU_ bản ghi"},bInfo:!1,bLengthChange:!0,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Tất cả"],],pageLength:10,listAction:{ajaxFunction:n.getAllDone,inputFilter:t},rowsGroup:{dataSrc:2},order:[[1,"asc"]],columnDefs:[{orderable:!1,className:"dt-body-center text-center",targets:0,data:null,render:function(n,t,i,r){return r.row+1}},{name:"first",orderable:!1,targets:1,data:"purchasesSynthesiseCode",render:function(n,t,i){return`
                        <a class="purchasesSynthesiseCode" data-objid='`+i.id+`' href='javascript:void(0); '>`+i.purchasesSynthesiseCode+`</a>
                    `}},{orderable:!1,targets:2,data:"subsidiaries",render:function(n,t,i){for(var u="",r=0;r<i.subsidiaries.length;r++)u+=`<span class="mb-1"> `+i.subsidiaries[r]+`</span><br>`;return u}},{orderable:!1,targets:3,data:"creationTime",render:function(n){return moment(n).format("L")}},{orderable:!1,targets:4,data:"statusAssignment",render:function(n,t,i){return i.statusAssignment==!0?`<span class="btn btn-outline-secondary btn-pills btn-sm btn-w-m  mr-1 waves-effect waves-themed span_status span-approve">Đã phân công</span>`:`<span class="btn btn-outline-primary btn-pills btn-sm btn-w-m  mr-1 waves-effect waves-themed span_status span-defaut">Chưa phân công</span>`}},{targets:5,data:null,"class":"text-center",orderable:!1,autoWidth:!1,render:function(n,t,i){return`                        
                          <a class="btn btn-primary docviewfunc"  data-objid='`+i.id+`'href='javascript:void(0); ' role="button">  <span class="fa fa-edit"></span> Phân công</a>
                                `}}],initComplete:function(){}}),e=r.DataTable({paging:!0,serverSide:!1,processing:!0,searching:!1,language:{emptyTable:"Không tìm thấy dữ liệu",lengthMenu:"Hiển thị _MENU_ bản ghi"},bInfo:!1,bLengthChange:!0,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Tất cả"],],pageLength:10,listAction:{ajaxFunction:n.getAllAssignment,inputFilter:t},rowsGroup:{dataSrc:2},order:[[0,"asc"]],columnDefs:[{orderable:!1,className:"dt-body-center text-center",targets:0,data:null,render:function(n,t,i,r){return r.row+1}},{name:"first",orderable:!1,targets:1,data:"purchasesSynthesiseCode",render:function(n,t,i){return`
                        <a class="detailview" data-objid='`+i.id+`' href='javascript:void(0); '>`+i.purchasesSynthesiseCode+`</a>
                    `}},{orderable:!1,targets:2,data:"subsidiaries",render:function(n,t,i){for(var u="",r=0;r<i.subsidiaries.length;r++)u+=`<span class="mb-1"> `+i.subsidiaries[r]+`</span><br>`;return u}},{orderable:!1,targets:3,data:"creationTime",render:function(n){return moment(n).format("L")}},{orderable:!1,targets:4,data:"dateAssignment",render:function(n){return moment(n).format("L")}},{orderable:!1,targets:5,className:"dt-body-center text-center",data:"statusAssignment",render:function(n,t,i){return i.statusAssignment==!0?`<span class="btn btn-outline-secondary btn-pills btn-sm btn-w-m  mr-1 waves-effect waves-themed span_status span-approve">Đã phân công</span>`:`<span class="btn btn-outline-primary btn-pills btn-sm btn-w-m  mr-1 waves-effect waves-themed span_status span-defaut">Chưa phân công</span>`}},]});$("#AllRequestTable").on("click",".docviewfunc",function(){var n=$(this),t={id:n[0].dataset.objid};u.open(t)});$("#AllRequestTable").on("click",".docview,.purchasesSynthesiseCode",function(){var n=$(this),t={id:n[0].dataset.objid};abp.ajax({contentType:"application/x-www-form-urlencoded",url:abp.appPath+"Inventorys/PurchaseAssignment/OverView?Id="+t.id,success:function(n){window.location.href="/Inventorys/PurchaseAssignment/Detail?Id="+n.id}})});$("#AllRequestTableDone").on("click",".detailview",function(){var n=$(this),t={id:n[0].dataset.objid};abp.ajax({contentType:"application/x-www-form-urlencoded",url:abp.appPath+"Inventorys/PurchaseAssignment/OverView?Id="+t.id,success:function(n){window.location.href="/Inventorys/PurchaseAssignment/DetailPurchaseAssignment?Id="+n.id}})});abp.event.on("app.reloadDocTable",function(){o()});abp.event.on("app.reloadTable",function(){s()})})(jQuery),function(){var t=$("#StaffTableItem"),i=abp.services.app.purchasesSynthesise,n,r;moment.locale(abp.localization.currentLanguage.name);n=function(){let n={};return n.id=$("#SynthesiseId").val().trim(),n};r=t.DataTable({paging:!0,serverSide:!1,processing:!1,searching:!1,language:{emptyTable:"Không tìm thấy dữ liệu",lengthMenu:"Hiển thị _MENU_ bản ghi"},bInfo:!1,bLengthChange:!1,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Tất cả"],],pageLength:5,listAction:{ajaxFunction:i.getAllItemByExpert,inputFilter:n},columnDefs:[{orderable:!1,targets:0,render:function(n,t,i,r){return r.row+1}},{orderable:!1,targets:1,data:"nameStaff"},{orderable:!1,targets:2,data:"itemcode"},{orderable:!1,targets:3,data:"itemsName"},{orderable:!1,targets:4,data:"supplierName"},{orderable:!1,targets:5,data:"unitName"},{orderable:!1,targets:6,data:"quantityItems"},{orderable:!1,targets:7,data:"dateTimeNeed",render:function(n){return moment(n).format("L")}},{orderable:!1,targets:8,data:"note"},]})}(jQuery),function(n){app.modals.ViewModal=function(){var o=n("#StaffTable"),i=abp.services.app.purchasesSynthesise,r=abp.services.app.purchaseAssignmentService,u=abp.services.app.itemsService,s=abp.services.app.expert,f=abp.services.app.assignments,t,e=null;this.init=function(r){function u(){return html=`
                    <th><select class="form-control  selectUsers UserId " id="selectUsers" style="width:120px" required>
                    <option value="" title="" selected disabled > Chọn chuyên viên </option>
                </select></th>`}function f(){var t=n(".selectUsers");n.each(t,function(t,i){var r=n(i).parents("tr").find(".selectUserId").attr("data-userid");s.getAllUserALL().done(function(t){n.each(t.items,function(t,r){n(i).append(n("<option>",{value:r.userId,text:r.name}))});n(i).val(r)})})}t=r;e=t.getModal().find("form[name=frmCreate]");var h=function(){let t={};return t.id=n("#SynthesiseId").val().trim(),t},c=o.DataTable({paging:!1,serverSide:!0,processing:!0,searching:!1,language:{emptyTable:"Không tìm thấy dữ liệu",lengthMenu:"Hiển thị _MENU_ bản ghi"},bInfo:!1,bLengthChange:!1,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Tất cả"],],pageLength:10,listAction:{ajaxFunction:i.getAllItemByExpert,inputFilter:h},columnDefs:[{orderable:!1,targets:0,render:function(n,t,i,r){return r.row+1}},{orderable:!1,targets:1,data:"nameStaff",render:function(){return u()}},{orderable:!1,targets:2,data:null,render:function(n,t,i){return`<span class="selectUserId" data-userid=`+i.userId+`>`+i.itemcode+`</span>`}},{orderable:!1,targets:3,className:"itemsName",data:"itemsName"},{orderable:!1,targets:4,className:"supplierName",data:"supplierName"},{orderable:!1,targets:5,className:"unitName",data:"unitName"},{orderable:!1,targets:6,className:"quantityItems",data:"quantityItems"},{orderable:!1,targets:7,className:"timeNeeded",data:"timeNeeded",render:function(n){return moment(n).format("L")}},{orderable:!1,targets:8,data:"note"},],initComplete:function(){f()}})};n(".cancel-work-button").click(function(){abp.libs.sweetAlert.config={confirm:{icon:"warning",buttons:["Không","Có"]}};abp.message.confirm(app.localize("Đóng phiếu nhập"),app.localize("Bạn có chắc không"),function(n){if(n)return t.close(),!0})});this.save=function(){var o=e.serializeFormToObject(),h,s;t.setBusy(!0);t.close();abp.notify.info("Phân công thành công");h=n("#StaffTable").DataTable().rows().data();s=n(".selectUsers");h.each(function(t,e){t.nameStaff==null?u.getItemByCode(t.itemcode).done(function(u){o.PurchasesSynthesiseId=t.id;o.ItemId=u.id;o.UserId=n(n(s)[e]).val();o.PurchasesSynthesiseCode=t.purchasesSynthesiseCode;o.GetPriceStatus=2;o.status=2;o.price=0;o.link=window.location.href;r.create(o).done(function(){abp.event.trigger("app.reloadTable");abp.event.trigger("app.reloadDocTable")});i.updateSyn(o).done(function(){abp.event.trigger("app.reloadTable");abp.event.trigger("app.reloadDocTable")});f.create(o).done(function(){abp.event.trigger("app.reloadTable");abp.event.trigger("app.reloadDocTable")})}):u.getItemByCode(t.itemcode).done(function(u){o.PurchasesSynthesiseId=t.id;o.ItemId=u.id;o.UserId=n(n(s)[e]).val();o.GetPriceStatus=2;o.status=2;o.price=0;o.link=window.location.href;o.PurchasesSynthesiseCode=t.purchasesSynthesiseCode;r.create(o).done(function(){abp.event.trigger("app.reloadTable");abp.event.trigger("app.reloadDocTable")});i.updateSyn(o).done(function(){abp.event.trigger("app.reloadTable");abp.event.trigger("app.reloadDocTable")});f.update(o).done(function(){abp.event.trigger("app.reloadTable");abp.event.trigger("app.reloadDocTable")})})})}}}(jQuery);