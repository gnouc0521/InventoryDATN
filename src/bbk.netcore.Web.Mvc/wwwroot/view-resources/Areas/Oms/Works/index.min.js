(function(){function w(n,t){return`<table id="ContractsTbl`+t+`" cellpadding="5" cellspacing="0" class="table table-bordered" style="width: 100%;">`+`<tr class="bg-fusion-50">`+`<th class="text-center"></th>`+`<th class="text-center"></th>`+`<th class="text-center"></th>`+`<th class="text-center"></th>`+`<th class="text-center"></th>`+`</tr>`+`</table>`}function h(){r.ajax.reload()}var u=$("#workTable"),f=abp.services.app.work,e="",o="",n,t,i,r,c;moment.locale(abp.localization.currentLanguage.name);var s={create:abp.auth.hasPermission("PersonalProfile.Work.Create"),edit:abp.auth.hasPermission("PersonalProfile.Work.Edit"),calender:abp.auth.hasPermission("PersonalProfile.Work.Calender")},l=new app.ModalManager({viewUrl:abp.appPath+"PersonalProfile/Work/CreateWork",scriptUrl:abp.appPath+"view-resources/Areas/Oms/Works/_CreateModal.js",modalClass:"CreatDelModal",modalType:"modal-xl"}),a=new app.ModalManager({viewUrl:abp.appPath+"PersonalProfile/Work/EditWorkModal",scriptUrl:abp.appPath+"view-resources/Areas/Oms/Works/_EditModal.js",modalClass:"DeliveryEditModal",modalType:"modal-xl"}),v=new app.ModalManager({viewUrl:abp.appPath+"PersonalProfile/Work/ViewDetails",modalClass:"ViewModal",modalType:"modal-xl"}),y=new app.ModalManager({viewUrl:abp.appPath+"PersonalProfile/ScheduleWork/CreateScheduleWork",scriptUrl:abp.appPath+"view-resources/Areas/Oms/ScheduleWorks/_CreateModal.js",modalClass:"ScheduleWorkCreateModal",modalType:"modal-xl"}),p=new app.ModalManager({viewUrl:abp.appPath+"PersonalProfile/Work/SelectUser",scriptUrl:abp.appPath+"view-resources/Areas/Oms/Works/_SelectUser.js",modalClass:"UserModal"});$("#CreateNewButtonxx").click(function(){l.open()});$(".date-picker").datepicker({rtl:!1,dateFormat:"dd-mm--yy",orientation:"left bottom",autoclose:!0,language:abp.localization.currentLanguage.name});$("#StartDay").datepicker({todayBtn:1,autoclose:!0}).on("changeDate",function(n){var t=new Date(n.date.valueOf());$("#EndDay").datepicker("setStartDate",t)});$("#EndDay").datepicker().on("changeDate",function(n){var t=new Date(n.date.valueOf());$("#StartDay").datepicker("setEndDate",t)});i=function(){let i={},r=document.getElementById("Priorty");return i.searchTerm=$("#SearchTerm").val(),i.statustest=$("#StatusTypeId").val(),i.priority=r.value,n!=null&&(e=moment(n).format("L"),i.dateStart=e),t!=null&&(o=moment(t).format("L"),i.dateEnd=o),i};r=$("#StatusTypeId").val()==2?u.DataTable({paging:!0,serverSide:!1,processing:!0,searching:!1,language:{emptyTable:"Không tìm thấy dữ liệu",lengthMenu:"Hiển thị _MENU_ bản ghi"},bInfo:!1,bLengthChange:!0,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Tất cả"],],pageLength:5,listAction:{ajaxFunction:f.getAllByStatus,inputFilter:i},columnDefs:[{targets:0,orderable:!1,className:"dt-control",render:function(n,t,i){return`<span class='bindofferid' selected='false' data-objid='`+i.id+`'></span>`}},{targets:1,data:null,orderable:!1,autoWidth:!1,render:function(n,t,i){return`                        
                            <div class='dropdown d-inline-block'>
                            	<a href='#'' class='btn btn-sm btn-icon btn-outline-primary rounded-circle shadow-0' data-toggle='dropdown' aria-expanded='true' title='More options'>
                            		<i class="fal fa-ellipsis-v"></i>
                            	</a>
                            	<div class='dropdown-menu'>
                            		<a class='dropdown-item doceditfunc'data-objid='`+i.id+`'href='javascript:void(0); ' > Sửa </a>
                            		<a class='dropdown-item docaddcalendar'data-objid='`+i.id+`'href='javascript:void(0); ' > Đặt lịch </a>
                                    <a class='dropdown-item doctransfer'data-objid='`+i.id+`'href='javascript:void(0); ' > Chuyển tiếp </a>
                            	</div>
                            </div>`}},{orderable:!0,targets:2,data:"title",render:function(n,t,i){return`
                        <a class="viewwork" data-objid='`+i.id+`' href='javascript:void(0); '>`+i.title+`</a>
                    `}},{orderable:!1,targets:3,data:"startDate",render:function(n){return moment(n).format("L")}},{targets:4,data:"endDate",render:function(n){return moment(n).format("L")}},{targets:5,data:"completionTime",render:function(n){return moment(n).format("L")}},{orderable:!0,targets:6,data:"priority",render:n=>`<span>${n==0?"Thấp":n==1?"Trung bình":"Cao"}</span>`},{orderable:!0,targets:7,data:"status",render:n=>`<span>${n==0?"Chờ xử lý":n==1?"Đang xử lý":n==2?"Hoàn thành":"Quá hạn"}</span >`},]}):u.DataTable({paging:!0,serverSide:!1,processing:!0,searching:!1,language:{emptyTable:"Không tìm thấy dữ liệu",lengthMenu:"Hiển thị _MENU_ bản ghi"},bInfo:!1,bLengthChange:!0,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Tất cả"],],pageLength:5,listAction:{ajaxFunction:f.getAllByStatus,inputFilter:i},columnDefs:[{targets:0,orderable:!1,className:"dt-control",render:function(n,t,i){return`<span class='bindofferid' selected='false' data-objid='`+i.id+`'></span>`}},{targets:1,data:null,orderable:!1,autoWidth:!1,render:function(n,t,i){return`                        
                            <div class='dropdown d-inline-block'>
                            	<a href='#'' class='btn btn-sm btn-icon btn-outline-primary rounded-circle shadow-0' data-toggle='dropdown' aria-expanded='true' title='More options'>
                            		<i class="fal fa-ellipsis-v"></i>
                            	</a>
                            	<div class='dropdown-menu'>
                            		<a class='dropdown-item doceditfunc'data-objid='`+i.id+`'href='javascript:void(0); ' > Sửa </a>
                            		<a class='dropdown-item docaddcalendar'data-objid='`+i.id+`'href='javascript:void(0); ' > Đặt lịch </a>
                                    <a class='dropdown-item doctransfer'data-objid='`+i.id+`'href='javascript:void(0); ' > Chuyển tiếp </a>
                            	</div>
                            </div>`}},{orderable:!0,targets:2,data:"title",render:function(n,t,i){return`
                        <a class="viewwork" data-objid='`+i.id+`' href='javascript:void(0); '>`+i.title+`</a>
                    `}},{orderable:!1,targets:3,data:"startDate",render:function(n){return moment(n).format("L")}},{targets:4,data:"endDate",render:function(n){return moment(n).format("L")}},{orderable:!0,targets:5,data:"priority",render:n=>`<span>${n==0?"Thấp":n==1?"Trung bình":"Cao"}</span>`},{orderable:!0,targets:6,data:"status",render:n=>`<span>${n==0?"Chờ xử lý":n==1?"Đang thực hiện":n==2?"Hoàn thành":"Quá hạn"}</span >`},]});abp.event.on("app.reloadDocTable",function(){h()});$("#workTable tbody").on("click","td.dt-control",function(){var n=$(this).closest("tr"),i=r.row(n),t=n[0].firstElementChild.firstElementChild.dataset.objid,u,f;n.attr("data-objid",t);i.child.isShown()?(i.child.hide(),n.removeClass("dt-hasChild shown")):(i.child(w(i.data(),t)).show(),n.addClass("dt-hasChild shown"),u=$("#ContractsTbl"+t),f=function(){let n={};return t!=null&&(n.offerId=t),taskstatus!=null&&(n.taskStatus=taskstatus),ContractStatus!=null&&(n.contractStatus=ContractStatus),n},datacontractTable=u.DataTable({paging:!1,serverSide:!0,processing:!1,ordering:!1,info:!1,searching:!1,language:{info:"Hiển thị _START_ đến _END_ của _TOTAL_ kết quả tìm thấy",infoEmpty:"",emptyTable:"Không tìm thấy hợp đồng!"},bLengthChange:!1,pageLength:10,columnDefs:[{orderable:!1,title:"ID",targets:0,className:"text-center",data:"id"},{orderable:!1,title:"Tên Công việc",targets:1,className:"text-center",data:"contractName"},{orderable:!1,title:"Ngày tạo",targets:2,className:"text-center",data:"creationTime",render:function(n){return moment(n).format("L")}},{orderable:!1,title:"Quy trình xử lý",targets:3,className:"text-center approvalworkflowth",data:"id",render:function(n){return`<span class='approvalworkflow' data-contractid=`+n+` ></span>`}},{orderable:!1,title:"Chức năng",targets:4,className:"text-center",data:"offerId",render:function(n,t,i){return`
                            <button type="button" style="color: #D4090e" class="btn btn-xs viewcontractfunc" data-offerid='`+n+`' data-contractid='`+i.id+`' />
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
                            <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                            </svg>
                            </button >
                                <button selected='false' type="button" class="btn btn-xs viewtaskhistory" style="color: red" data-offerid='`+n+`' data-objid='`+i.id+`'>
                                <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-clock-history" viewBox="0 0 16 16">
                                <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022l-.074.997zm2.004.45a7.003 7.003 0 0 0-.985-.299l.219-.976c.383.086.76.2 1.126.342l-.36.933zm1.37.71a7.01 7.01 0 0 0-.439-.27l.493-.87a8.025 8.025 0 0 1 .979.654l-.615.789a6.996 6.996 0 0 0-.418-.302zm1.834 1.79a6.99 6.99 0 0 0-.653-.796l.724-.69c.27.285.52.59.747.91l-.818.576zm.744 1.352a7.08 7.08 0 0 0-.214-.468l.893-.45a7.976 7.976 0 0 1 .45 1.088l-.95.313a7.023 7.023 0 0 0-.179-.483zm.53 2.507a6.991 6.991 0 0 0-.1-1.025l.985-.17c.067.386.106.778.116 1.17l-1 .025zm-.131 1.538c.033-.17.06-.339.081-.51l.993.123a7.957 7.957 0 0 1-.23 1.155l-.964-.267c.046-.165.086-.332.12-.501zm-.952 2.379c.184-.29.346-.594.486-.908l.914.405c-.16.36-.345.706-.555 1.038l-.845-.535zm-.964 1.205c.122-.122.239-.248.35-.378l.758.653a8.073 8.073 0 0 1-.401.432l-.707-.707z"></path>
                                <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0v1z"></path>
                                <path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5z"></path>
                                <span selected='false' style='color: red' class='viewtaskhistory' data-offerid='`+n+`' data-objid='`+i.id+`'></span>
                                </svg>
                            </button>`}}],initComplete:function(n){$(".approvalworkflowth").css("width","500px");for(var t=0;t<n.aoData.length;t++)GetProcessContract(n.aoData[t]._aData.id)}}))});$("#workTable").on("click",".doceditfunc",function(){var t=$(this),n;s.edit?(n={id:t[0].dataset.objid,StatusId:$("#StatusTypeId").val()},a.open(n)):abp.notify.error("Bạn không có quyền")});$("#workTable").on("click",".viewwork",function(){var n=$(this),t={id:n[0].dataset.objid};v.open(t)});$("#workTable").on("click",".docaddcalendar",function(){s.calender?y.open():abp.notify.error("Bạn không có quyền")});$("#workTable").on("click",".doctransfer",function(){p.open()});$("#Search").click(function(i){i.preventDefault();$("#StartDay").datepicker();$("#EndDay").datepicker();n=$("#StartDay").datepicker("getDate");t=$("#EndDay").datepicker("getDate");h()});jQuery(document).ready(function(){$("#SearchTerm").focus()});c=$("#StatusIdss").val();$("#ListStatus").val(c).trigger("change");$(document).ready(function(){jQuery("#ListStatus").change(function(){var n=jQuery(this).children(":selected").attr("value");n=$("#ListStatus").val();$("#ListStatus option").removeAttr("selected");$("#ListStatus > [value ="+n+"]").attr("selected","true");$.ajax({url:"/PersonalProfile/Work/Index",type:"GET",data:{StatusId:n},success:function(){window.location.href="/PersonalProfile/Work?StatusId="+n},error:function(){alert("error")}})})})})(jQuery),function(n){app.modals.CreatDelModal=function(){var o=n("#attactfile-tbl"),s=abp.services.app.uploadFileCVService,f=abp.services.app.work,e=abp.services.app.dayOff,i,t=null,r,u;this.init=function(o){n("#Description").summernote({height:270,forcus:!0});i=o;t=i.getModal().find("form[name=frmCreate]");n(".date-picker").datepicker({rtl:!1,dateFormat:"dd-mm--yy",startDate:"-0d",orientation:"left",autoclose:!0,noWeekends:!0,language:abp.localization.currentLanguage.name});n("#StartDate").datepicker({todayBtn:1,autoclose:!0}).on("changeDate",function(t){var i=new Date(t.date.valueOf());n("#EndDate").datepicker("setStartDate",i);r=n("#StartDate").datepicker("getDate");f.checkDayOffStart(r).done(function(t){if(t==!1)e.getAllDate(r).done(function(t){for(var i=0;i<=t.length;i++){alert("Lưu ý ngày nghỉ "+t[i].title+"! Mời chọn lại");n("#StartDate").datepicker("show");break}});else return!0})});n("#EndDate").datepicker().on("changeDate",function(t){var i=new Date(t.date.valueOf());n("#StartDate").datepicker("setEndDate",i);u=n("#EndDate").datepicker("getDate");f.checkDayOffStart(u).done(function(t){if(t==!1)e.getAllDate(u).done(function(t){for(var i=0;i<=t.length;i++){alert("Lưu ý ngày nghỉ "+t[i].title+"! Mời chọn lại");n("#EndDate").datepicker("show");break}});else return!0})});n(".file-upload-field").bind("change",function(){infoAttactfile=n(this).prop("files");var t=n(this).next(".custom-file-label");infoAttactfile.length>1?t.html(infoAttactfile.length+" file được chọn"):n(this).parent().find(".custom-file-label").html(n(this).val().replace(/.*(\/|\\)/,""))});t.ajaxForm({beforeSubmit:function(){var u=t.find("input[name=file]"),n=u.get()[0].files,r;return n.length&&(r=n[0],r.size>10485760)?(abp.message.warn(app.localize("File_SizeLimit_Error")),i.setBusy(!1),!1):!0},success:function(n){n.success?(abp.notify.info("Thêm mới thành công!"),i.close(),abp.event.trigger("app.reloadDocTable")):(abp.message.error(n.error.message),i.setBusy(!1))},error:function(n){abp.message.error(n.error.message)}})};n(".cancel-work-button").click(function(){abp.libs.sweetAlert.config={confirm:{icon:"warning",buttons:["Không","Có"]}};abp.message.confirm(app.localize("Đóng công việc"),app.localize("Bạn có chắc không"),function(n){if(n)return i.close(),!0})});this.save=function(){var i=n("#Description").summernote("code"),r=t.serializeFormToObject();if(r.description=i,t.addClass("was-validated"),t[0].checkValidity()===!1){event.preventDefault();event.stopPropagation();return}t.submit()}}}(jQuery),function(n){app.modals.DeliveryEditModal=function(){var e=abp.services.app.work,o=abp.services.app.userWork,h=abp.services.app.dayOff,r,u=null,f=[],s=[],t={},c=null,a=n("#attactfile-tbl"),l=abp.services.app.uploadFileCVService;this.init=function(v){function w(){c.ajax.reload()}function b(n){abp.message.confirm(app.localize("Xóa tài liệu"),app.localize("Bạn có chắc không"),t=>{t&&l.deleteUploadFile(n).done(()=>{abp.notify.success(app.localize("Xoá tài liệu thành công!")),w()})})}var y,p;r=v;u=r.getModal().find("form[name=FrmEdit]");n("#Description").summernote({height:270,forcus:!0});n(".select2-placeholder-multiple ").select2({placeholder:"All Items",allowClear:!0});n("ul.select2-selection__rendered").sortable({containment:"parent"});y=n("#Id").val();o.getUserIdByWorkId(y).done(function(t){var i=[];n.each(t.items,function(n,t){i[n]=t.userId});n("[name=multiple-placeholder]").val(i).trigger("change")});n(".file-upload-field").bind("change",function(){infoAttactfile=n(this).prop("files");var t=n(this).next(".custom-file-label");infoAttactfile.length>1?(t.html(infoAttactfile.length+" file được chọn"),w()):n(this).parent().find(".custom-file-label").html(n(this).val().replace(/.*(\/|\\)/,""))});p=function(){let t={};return t.workId=n("#Id").val(),t};c=a.DataTable({paging:!1,serverSide:!0,processing:!1,ordering:!1,info:!1,searching:!1,language:{info:"Hiển thị _START_ đến _END_ của _TOTAL_ kết quả tìm thấy",infoEmpty:"",emptyTable:"",zeroRecords:" "},bLengthChange:!1,pageLength:10,listAction:{ajaxFunction:l.getAllById,inputFilter:p},columnDefs:[{orderable:!1,targets:0,data:"fileName",render:function(n,t,i){return`<a href="`+i.fileUrl+`" style='color: blue' data-filepath='`+i.fileUrl+`' data-filename='`+i.fileName+`'>`+n+`</a>`}},{orderable:!1,targets:1,data:"creationTime",render:function(n){return moment(n).format("DD/MM/YYYY HH:mm")}},{orderable:!1,targets:2,data:"createBy"},{orderable:!1,targets:3,className:"text-center",data:"id",render:function(n,t,i){return`<a style='color: blue; cursor: pointer' class="text-decoration-none deletefunc" data-objid='`+n+`' data-objfname='`+i.fileName+`' data-objcontractid='`+i.contractId+`'>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"></path>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"></path>
                                    </svg>
                                    </a>`}}],initComplete:function(){n("#attactfile-tbl").css("width","100%")}});n("#attactfile-tbl").on("click",".deletefunc",function(){var t=n(this),i={contractId:t[0].dataset.objcontractid,fileName:t[0].dataset.objfname};b(i)});n("#multiple-placeholder").select2({}).on("select2:select",function(n){f.push(parseInt(n.params.data.id))});n("#multiple-placeholder").select2({}).on("select2:unselect",function(n){s.push(parseInt(n.params.data.id))});n("#btnHoanThanh").on("click",function(){var n=u.serializeFormToObject();e.changstatus(n).done(function(){r.close();abp.notify.info("Cập nhật thành công!");abp.event.trigger("app.reloadDocTable")})});n(".date-picker").datepicker({rtl:!1,dateFormat:"dd-mm--yy",orientation:"left",autoclose:!0,language:abp.localization.currentLanguage.name});n("#StartDate").datepicker({todayBtn:1,autoclose:!0}).on("changeDate",function(t){var i=new Date(t.date.valueOf());n("#EndDate").datepicker("setStartDate",i);n("#EndDate").datepicker("setDate",i);start=n("#StartDate").datepicker("getDate");e.checkDayOffStart(start).done(function(t){if(t==!1)h.getAllDate(start).done(function(t){for(var i=0;i<=t.length;i++){alert("Lưu ý ngày nghỉ "+t[i].title+"! Mời chọn lại");n("#StartDate").datepicker("show");break}});else return!0})});n("#EndDate").datepicker().on("changeDate",function(t){var i=new Date(t.date.valueOf());n("#StartDate").datepicker("setEndDate",i);end=n("#EndDate").datepicker("getDate");e.checkDayOffStart(end).done(function(t){if(t==!1)h.getAllDate(end).done(function(t){for(var i=0;i<=t.length;i++){alert("Lưu ý ngày nghỉ "+t[i].title+"! Mời chọn lại");n("#EndDate").datepicker("show");break}});else return!0})});u.ajaxForm({beforeSubmit:function(){var i=u.find("input[name=file]"),n=i.get()[0].files,t;return n.length&&(t=n[0],t.size>10485760)?(abp.message.warn(app.localize("File_SizeLimit_Error")),r.setBusy(!1),!1):!0},success:function(n){var h=u.serializeFormToObject();n.success?e.getById(h.Id).done(function(n){if(s.length==0){for(t.workId=n.id,t.status=n.status,t.ownerStatus=2,i=0;i<f.length;i++)t.userid=f[i],o.create(t).done(function(){});abp.notify.info("Cập nhật thành công!");r.close();abp.event.trigger("app.reloadDocTable")}else{for(i=0;i<s.length;i++)o.delete(s[i]).done(function(){});for(t.workId=n.id,t.status=n.status,t.ownerStatus=2,i=0;i<f.length;i++)t.userid=f[i],o.create(t).done(function(){});abp.notify.info("Cập nhật thành công!");r.close();abp.event.trigger("app.reloadDocTable")}}):(abp.message.error(n.error.message),r.setBusy(!1))},error:function(n){abp.message.error(n.error.message)}});n(".cancel-work-button").click(function(){abp.libs.sweetAlert.config={confirm:{icon:"warning",buttons:["Không","Có"]}};abp.message.confirm(app.localize("Đóng công việc"),app.localize("Bạn có chắc không"),function(n){if(n)return r.close(),!0})})};this.save=function(){if(u.addClass("was-validated"),u[0].checkValidity()===!1){event.preventDefault();event.stopPropagation();return}u.submit()}}}(jQuery);